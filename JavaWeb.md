### JavaWeb

------



### 1ã€åŸºæœ¬æ¦‚å¿µ

#### 1.1ã€å‰è¨€

webå¼€å‘ï¼š

- webï¼Œç½‘é¡µçš„æ„æ€ï¼Œwww.baidu.com
- é™æ€web
  - html,css
  - æä¾›ç»™æ‰€æœ‰äººçœ‹çš„æ•°æ®å§‹ç»ˆä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼
- åŠ¨æ€web
  - æ·˜å®ï¼Œå‡ ä¹æ˜¯æ‰€æœ‰çš„ç½‘ç«™ï¼›
  - æä¾›ç»™æ‰€æœ‰äººçœ‹çš„æ•°æ®å§‹ç»ˆä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ¯ä¸ªäººåœ¨ä¸åŒçš„æ—¶é—´ï¼Œä¸åŒçš„åœ°ç‚¹çœ‹åˆ°çš„ä¿¡æ¯å„ä¸ç›¸åŒ
  - æŠ€æœ¯æ ˆï¼šServletã€JSPï¼ŒASP,PHP

åœ¨Javaä¸­ï¼ŒåŠ¨æ€webèµ„æºå¼€å‘çš„æŠ€æœ¯ç»Ÿç§°ä¸ºjavaWeb;

#### 1.2ã€webåº”ç”¨ç¨‹åº

webåº”ç”¨ç¨‹åºï¼šå¯ä»¥æä¾›æµè§ˆå™¨è®¿é—®çš„ç¨‹åºï¼›

- a.htmlã€b.html....å¤šä¸ªwebèµ„æºï¼Œè¿™äº›webèµ„æºå¯ä»¥è¢«å¤–éƒ¨è®¿é—®ï¼Œå¯¹å¤–ç•Œæä¾›æœåŠ¡ï¼›
- ä½ ä»¬èƒ½è®¿é—®åˆ°çš„ä»»ä½•ä¸€ä¸ªé¡µé¢æˆ–è€…èµ„æºï¼Œéƒ½å­˜åœ¨äºè¿™ä¸ªä¸–ç•Œçš„æŸä¸€ä¸ªè§’è½çš„è®¡ç®—æœºä¸Šã€‚
- URL
- è¿™ä¸ªç»Ÿä¸€çš„webèµ„æºä¼šè¢«æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œwebåº”ç”¨ç¨‹åº-->Tomcatï¼šæœåŠ¡å™¨
- ä¸€ä¸ªwebåº”ç”¨ç”±å¤šä¸ªéƒ¨åˆ†ç»„æˆï¼ˆé™æ€web,åŠ¨æ€webï¼‰
  - html,css,js
  - jsp,servlet
  - javaç¨‹åº
  - jaråŒ…
  - é…ç½®æ–‡ä»¶ï¼ˆPropertiesï¼‰

webåº”ç”¨ç¨‹åºç¼–å†™å®Œæ¯•åï¼Œè‹¥æƒ³æä¾›ç»™å¤–ç•Œè®¿é—®ï¼šéœ€è¦ä¸€ä¸ªæœåŠ¡å™¨æ¥ç»Ÿä¸€ç®¡ç†ï¼›

#### 1.3ã€é™æ€web

- *.htm, *.html,è¿™äº›éƒ½æ˜¯ç½‘é¡µçš„åç¼€ï¼Œå¦‚æœæœåŠ¡å™¨ä¸Šä¸€ç›´å­˜åœ¨è¿™äº›ä¸œè¥¿ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è¿›è¡Œè¯»å–ã€‚é€šç»œï¼›

![image-20220307191423938](JavaWeb.assets/image-20220307191423938.png)

- é™æ€webå­˜åœ¨çš„ç¼ºç‚¹
  - webé¡µé¢æ— æ³•åŠ¨æ€æ›´æ–°ï¼Œæ‰€æœ‰ç”¨æˆ·çœ‹åˆ°çš„éƒ½æ˜¯åŒä¸€ä¸ªé¡µé¢
    - è½®æ’­å›¾ï¼Œç‚¹å‡»ç‰¹æ•ˆï¼šä¼ªåŠ¨æ€
    - JavaScript[å®é™…å¼€å‘ä¸­ï¼Œå®ƒç”¨çš„æœ€å¤š]
    - VBScript
  - å®ƒæ— æ³•å’Œæ•°æ®åº“äº¤äº’ï¼ˆæ•°æ®æ— æ³•æŒä¹…åŒ–ï¼Œç”¨æˆ·æ— æ³•äº¤äº’ï¼‰

#### 1.4ã€åŠ¨æ€web

é¡µé¢ä¼šåŠ¨æ€å±•ç¤ºï¼šâ€œwebçš„é¡µé¢å±•ç¤ºçš„æ•ˆæœå› äººè€Œå¼‚â€ï¼›

![image-20220307192050271](JavaWeb.assets/image-20220307192050271.png)

ç¼ºç‚¹

- å‡å¦‚æœåŠ¡å™¨çš„åŠ¨æ€webèµ„æºå‡ºç°äº†é”™è¯¯ï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°ç¼–å†™æ–°çš„åå°ç¨‹åºï¼Œé‡æ–°å‘å¸ƒï¼›
  - åœæœºç»´æŠ¤

ä¼˜ç‚¹ï¼š

- webé¡µé¢å¯ä»¥åŠ¨æ€æ›´æ–°ï¼Œæ‰€æœ‰ç”¨æˆ·çœ‹åˆ°çš„éƒ½ä¸æ˜¯åŒä¸€ä¸ªé¡µé¢
- å®ƒå¯ä»¥å’Œæ•°æ®åº“äº¤äº’ï¼ˆæ•°æ®æŒä¹…åŒ–ï¼šæ³¨å†Œï¼Œå•†å“ä¿¡æ¯ï¼Œç”¨æˆ·ä¿¡æ¯......ï¼‰

![image-20220307192416607](JavaWeb.assets/image-20220307192416607.png)



ï¼ˆåˆ†æåŸç†ï¼Œçœ‹æºç ï¼‰



### 2ã€webæœåŠ¡å™¨

#### 2.1ã€æŠ€æœ¯è®²è§£

**ASP:**

- å¾®è½¯ï¼šå›½å†…æœ€æ—©æµè¡Œçš„å°±æ˜¯ASP
- åœ¨HTMLä¸­åµŒå…¥äº†VBçš„è„šæœ¬ï¼ŒASP+COM;
- åœ¨ASPå¼€å‘ä¸­ï¼ŒåŸºæœ¬ä¸€ä¸ªé¡µé¢éƒ½æœ‰å‡ åƒè¡Œçš„ä¸šåŠ¡ä»£ç ï¼Œé¡µé¢æå…¶æ··ä¹±
- ç»´æŠ¤æˆæœ¬é«˜ï¼
- C#
- IISæœåŠ¡å™¨



**PHPï¼š**

- phpå¼€å‘é€Ÿåº¦å¾ˆå¿«ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œè·¨å¹³å°ï¼Œä»£ç å¾ˆç®€å•ï¼ˆ70%ï¼ŒWPï¼‰
- æ— æ³•æ‰¿è½½å¤§è®¿é—®é‡çš„æƒ…å†µï¼ˆå±€é™æ€§ï¼‰



**JSP/Servlet:**

B/Sï¼šæµè§ˆå™¨å’ŒæœåŠ¡å™¨

C/S:å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯

- sunå…¬å¸ä¸»æ¨çš„B/Sæ¶æ„
- åŸºäºjavaè¯­è¨€çš„ï¼ˆæ‰€æœ‰çš„å¤§å…¬å¸ï¼Œæˆ–è€…ä¸€äº›å¼€æºçš„ç»„ä»¶ï¼Œéƒ½æ˜¯ç”¨Javaå†™çš„ï¼‰
- å¯ä»¥æ‰¿è½½ä¸‰é«˜(é«˜å¹¶å‘ï¼Œé«˜å¯ç”¨ï¼Œé«˜æ€§èƒ½)é—®é¢˜å¸¦æ¥çš„å½±å“ï¼›
- è¯­æ³•å‘ASP,ASP-->JSP,åŠ å¼ºå¸‚åœºå¼ºåº¦ï¼›

.....



#### 2.2ã€webæœåŠ¡å™¨

æœåŠ¡å™¨æ˜¯ä¸€ç§è¢«åŠ¨çš„æ“ä½œï¼Œç”¨æ¥å¤„ç†ç”¨æˆ·çš„ä¸€äº›è¯·æ±‚å’Œç»™ç”¨æˆ·çš„ä¸€äº›å“åº”ä¿¡æ¯



**IIS**

å¾®è½¯çš„ï¼šASP...,Windowsä¸­è‡ªå¸¦çš„

**Tomcat**

é¢å‘ç™¾åº¦ç¼–ç¨‹ï¼›

â€‹	Tomcatæ˜¯Apacheè½¯ä»¶åŸºé‡‘ä¼šï¼ˆApache Software Foundationï¼‰çš„Jakartaé¡¹ç›®ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒé¡¹ç›®ï¼Œæœ€æ–°çš„Servletå’ŒISPè§„èŒƒæ€»æ˜¯èƒ½åœ¨Tomcatä¸­å¾—åˆ°ä½“ç°ï¼Œå› ä¸ºTomcatæŠ€æœ¯å…ˆè¿›ã€æ€§èƒ½ç¨³å®šï¼Œè€Œä¸”å…è´¹ï¼Œå› è€Œæ·±å—Java çˆ±å¥½è€…çš„å–œçˆ±å¹¶å¾—åˆ°äº†éƒ¨åˆ†è½¯ä»¶å¼€å‘å•†çš„è®¤å¯ï¼Œæˆä¸ºç›®å‰æ¯”è¾ƒæµè¡Œçš„Web åº”ç”¨æœåŠ¡å™¨ã€‚

â€‹	Tomcat æœåŠ¡å™¨æ˜¯ä¸€ä¸ªå…è´¹çš„å¼€æ”¾æºä»£ç çš„Web åº”ç”¨æœåŠ¡å™¨ï¼Œå±äºè½»é‡çº§åº”ç”¨æœåŠ¡å™¨ï¼Œåœ¨ä¸­å°å‹ç³»ç»Ÿå’Œå¹¶å‘è®¿é—®ç”¨æˆ·ä¸æ˜¯å¾ˆå¤šçš„åœºåˆä¸‹è¢«æ™®éä½¿ç”¨ï¼Œæ˜¯å¼€å‘å’Œè°ƒè¯•ISP ç¨‹åºçš„é¦–é€‰ã€‚å¯¹äºä¸€ä¸ªJavaåˆå­¦webçš„äººæ¥è¯´ï¼Œå®ƒæ˜¯æœ€ä½³çš„é€‰æ‹©

â€‹	Tomcat å®é™…ä¸Šè¿è¡ŒISP é¡µé¢å’ŒServletã€‚Tomcatæœ€æ–°ç‰ˆæœ¬ä¸º9.0ã€‚

......

**å·¥ä½œ3-5å¹´ä¹‹åï¼Œå¯ä»¥å°è¯•æ‰‹å†™TomcatæœåŠ¡å™¨ï¼›**

ä¸‹è½½tomcat:

1. å®‰è£… or è§£å‹
2. äº†è§£é…ç½®æ–‡ä»¶åŠç›®å½•ç»“æ„
3. è¿™ä¸ªä¸œè¥¿çš„ä½œç”¨



### 3ã€Tomcat

#### 3.1ã€å®‰è£…tomcat

tomcatå®˜ç½‘ï¼šhttps://tomcat.apache.org/

#### 3.2ã€Tomcatå¯åŠ¨å’Œé…ç½®

æ–‡ä»¶å¤¹ä½œç”¨ï¼š

![image-20220307195117261](JavaWeb.assets/image-20220307195117261.png)

å¯åŠ¨ã€å…³é—­Tomcat

![image-20220307195308556](JavaWeb.assets/image-20220307195308556.png)

è®¿é—®æµ‹è¯•ï¼šhttp://localhost:8080/

å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼š

1. javaç¯å¢ƒå˜é‡æ²¡æœ‰é…ç½®
2. é—ªé€€é—®é¢˜ï¼šéœ€è¦é…ç½®å…¼å®¹æ€§
3. ä¹±ç é—®é¢˜ï¼šé…ç½®æ–‡ä»¶ä¸­è®¾ç½®

#### 3.3ã€é…ç½®

![image-20220307200216693](JavaWeb.assets/image-20220307200216693.png)



å¯ä»¥é…ç½®å¯åŠ¨çš„ç«¯å£å·

- tomcatçš„é»˜è®¤ç«¯å£ï¼š8080
- MySQLçš„é»˜è®¤ç«¯å£ï¼š3306
- httpçš„é»˜è®¤ç«¯å£ï¼š80
- httpsçš„é»˜è®¤ç«¯å£:443

```jsp
 <Connector port="8080" protocol="HTTP/1.1"
               connectionTimeout="20000"
               redirectPort="8443" />
```

å¯ä»¥é…ç½®ä¸»æœºçš„åç§°

- é»˜è®¤çš„ä¸»æœºåä¸ºï¼šlocalhost-->127.0.0.1
- é»˜è®¤ç½‘ç«™åº”ç”¨å­˜æ”¾çš„ä½ç½®ä¸ºï¼šwebapps

```jsp
<Host name="localhost"  appBase="webapps"
            unpackWARs="true" autoDeploy="true">
```

**é«˜éš¾åº¦é¢è¯•é¢˜ï¼š**

è¯·ä½ è°ˆä¸€è°ˆç½‘ç«™æ˜¯å¦‚ä½•è¿›è¡Œè®¿é—®çš„ï¼Ÿ

1. è¾“å…¥ä¸€ä¸ªåŸŸåï¼Œå›è½¦

2. æ£€æŸ¥æœ¬æœºçš„C:\Windows\System32\drivers\etc\hostsé…ç½®æ–‡ä»¶ä¸‹æœ‰æ²¡æœ‰è¿™ä¸ªåŸŸåæ˜ å°„

   1. æœ‰ï¼šç›´æ¥è¿”å›å¯¹åº”çš„ipåœ°å€ï¼Œè¿™ä¸ªåœ°å€ä¸­æœ‰æˆ‘ä»¬éœ€è¦è®¿é—®çš„webç¨‹åºï¼Œå¯ä»¥ç›´æ¥è®¿é—®

   ```java
   127.0.0.1  www.pengfei.com
   ```

   2.æ²¡æœ‰ï¼šå»DNSæœåŠ¡å™¨ä¸Šå»æ‰¾ï¼Œæ‰¾åˆ°çš„è¯å°±è¿”å›ï¼Œæ‰¾ä¸åˆ°çš„è¯å°±è¿”å›æ‰¾ä¸åˆ°

   ![image-20220307201710498](JavaWeb.assets/image-20220307201710498.png)



#### 3.4ã€å‘å¸ƒä¸€ä¸ªwebç½‘ç«™

ä¸ä¼šå°±å…ˆæ¨¡ä»¿

- å°†è‡ªå·±å†™çš„ç½‘ç«™ï¼Œæ”¾åˆ°æœåŠ¡å™¨ï¼ˆtomcatï¼‰ä¸­æŒ‡å®šçš„webåº”ç”¨çš„æ–‡ä»¶å¤¹ï¼ˆwebappsï¼‰ä¸‹ï¼Œå°±å¯ä»¥è®¿é—®äº†

ç½‘ç«™åº”è¯¥æœ‰çš„ç»“æ„

```java
--webapps:TomcatæœåŠ¡å™¨çš„webç›®å½•
	-Root
	-pengfei:ç½‘ç«™çš„ç›®å½•å
		-WEB-INF
			-classes:javaç¨‹åº
			-lib:webåº”ç”¨æ‰€ä¾èµ–çš„jaråŒ…
			-web.xmlï¼šç½‘ç«™é…ç½®æ–‡ä»¶
		-index.html é»˜è®¤çš„é¦–é¡µ
		-static
			-css
				-style.css
			-js
			-img
		-......
```



HTTPåè®®ï¼šé¢è¯•

Maven:æ„å»ºå·¥å…·

- Mavenå®‰è£…åŒ…

Servletå…¥é—¨

- Helloworld!
- Servleté…ç½®
- åŸç†



### 4ã€Http

#### 4.1ã€ä»€ä¹ˆæ˜¯HTTP

HTTP(è¶…æ–‡æœ¬ä¼ è¾“åè®®)æ˜¯ä¸€ä¸ªç®€å•çš„è¯·æ±‚-å“åº”åè®®ï¼Œå®ƒé€šå¸¸è¿è¡Œåœ¨TCPä¹‹ä¸Šã€‚

- æ–‡æœ¬ï¼šhtmlï¼Œå­—ç¬¦ä¸²ï¼Œ~....
- è¶…æ–‡æœ¬ï¼š***è¶…æ–‡æœ¬*æ˜¯ç”¨è¶…é“¾æ¥çš„æ–¹æ³•ï¼Œå°†å„ç§ä¸åŒç©ºé—´çš„æ–‡å­—ä¿¡æ¯ç»„ç»‡åœ¨ä¸€èµ·çš„ç½‘çŠ¶æ–‡æœ¬**(å›¾ç‰‡ï¼ŒéŸ³ä¹ï¼Œè§†é¢‘,å®šä½ï¼Œåœ°å›¾.....)
- 80

https:å®‰å…¨çš„

- 443



#### 4.2ã€ä¸¤ä¸ªæ—¶ä»£

- http1.0
  - http/1.0:å®¢æˆ·ç«¯å¯ä»¥ä¸webæœåŠ¡å™¨è¿æ¥åï¼Œåªèƒ½è·å¾—ä¸€ä¸ªwebèµ„æºï¼Œæ–­å¼€è¿æ¥
- http2.0
  - http/1.1ï¼šå®¢æˆ·ç«¯å¯ä»¥ä¸webæœåŠ¡å™¨è¿æ¥åï¼Œå¯ä»¥è·å¾—å¤šä¸ªwebèµ„æºã€‚

#### 4.3ã€httpè¯·æ±‚

- å®¢æˆ·ç«¯--å‘è¯·æ±‚(request)--æœåŠ¡å™¨

ç™¾åº¦ï¼š

```java
Request URL: https://www.baidu.com/sugrec?prod=pc_his&from=pc_web&json=1&sid=31253_26350&hisdata=&_t=1646659996284&csor=0 //è¯·æ±‚åœ°å€
Request Method: GET //getæ–¹æ³•ã€postæ–¹æ³•
Status Code: 200 OK  //çŠ¶æ€ç 
Remoteï¼ˆè¿œç¨‹ï¼‰ Address: 110.242.68.3:443
```

```java
Accept: text/plain, */*; q=0.01
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9  è¯­è¨€
Connection: keep-alive
```

##### **1ã€è¯·æ±‚è¡Œ**

- è¯·æ±‚è¡Œä¸­çš„è¯·æ±‚æ–¹å¼ï¼šget
- è¯·æ±‚æ–¹å¼ï¼šGetï¼ŒPost,head,delete,put,tract...
  - get:è¯·æ±‚èƒ½å¤Ÿæºå¸¦çš„å‚æ•°æ¯”è¾ƒå°‘ï¼Œå¤§å°æœ‰é™åˆ¶ï¼Œä¼šåœ¨æµè§ˆå™¨çš„URLåœ°å€æ æ˜¾ç¤ºæ•°æ®å†…å®¹ï¼Œä¸å®‰å…¨ï¼Œä½†é«˜æ•ˆ
  - post:è¯·æ±‚èƒ½å¤Ÿæºå¸¦çš„å‚æ•°æ²¡æœ‰é™åˆ¶ï¼Œå¤§å°æ²¡æœ‰é™åˆ¶ï¼Œä¸ä¼šåœ¨æµè§ˆå™¨çš„URLåœ°å€æ æ˜¾ç¤ºæ•°æ®å†…å®¹ï¼Œå®‰å…¨ï¼Œä½†ä¸é«˜æ•ˆ



##### **2ã€æ¶ˆæ¯å¤´**

```java
Accept: å‘Šè¯‰æµè§ˆå™¨ï¼Œä»–æ‰€æ”¯æŒçš„æ•°æ®ç±»å‹
Accept-Encoding: æ”¯æŒå“ªç§ç¼–ç æ ¼å¼ GBK utf-8 GB2312 ISO8859-1
Accept-Language:  å‘Šè¯‰æµè§ˆå™¨ï¼Œä»–çš„è¯­è¨€ç¯å¢ƒ
Cache-Control:ç¼“å­˜æ§åˆ¶
Connection:å‘Šè¯‰æµè§ˆå™¨ï¼Œè¯·æ±‚å®Œæˆæ˜¯æ–­å¼€è¿˜æ˜¯ä¿æŒè¿æ¥
HOST:ä¸»æœº...
```



#### 4.4ã€httpå“åº”

- æœåŠ¡å™¨--å“åº”--å®¢æˆ·ç«¯

ç™¾åº¦ï¼š

```java
Cache-Control: private  ç¼“å­˜æ§åˆ¶
Connection: keep-alive  è¿æ¥ï¼šä¿æŒè¿æ¥
Content-Encoding: gzip  ç¼–ç 
Content-Type: text/html;charset=utf-8 ç±»å‹
```

##### 1ã€å“åº”ä½“

```java
Accept: å‘Šè¯‰æµè§ˆå™¨ï¼Œä»–æ‰€æ”¯æŒçš„æ•°æ®ç±»å‹
Accept-Encoding: æ”¯æŒå“ªç§ç¼–ç æ ¼å¼ GBK utf-8 GB2312 ISO8859-1
Accept-Language:  å‘Šè¯‰æµè§ˆå™¨ï¼Œä»–çš„è¯­è¨€ç¯å¢ƒ
Cache-Control:ç¼“å­˜æ§åˆ¶
Connection:å‘Šè¯‰æµè§ˆå™¨ï¼Œè¯·æ±‚å®Œæˆæ˜¯æ–­å¼€è¿˜æ˜¯ä¿æŒè¿æ¥
HOST:ä¸»æœº...
Refrush:å‘Šè¯‰å®¢æˆ·ç«¯ï¼Œå¤šä¹…åˆ·æ–°ä¸€æ¬¡
Locationï¼šè®©ç½‘é¡µé‡æ–°å®šä½ï¼›
```

##### 2ã€å“åº”çŠ¶æ€ç ï¼ˆé‡ç‚¹ï¼‰

200ï¼šè¯·æ±‚å“åº”æˆåŠŸ 200

3xxï¼šè¯·æ±‚é‡å®šå‘

- é‡å®šå‘ï¼šä½ é‡æ–°åˆ°æˆ‘ç»™ä½ çš„æ–°ä½ç½®å»ï¼›

4xxï¼šæ‰¾ä¸åˆ°èµ„æº 404

- èµ„æºä¸å­˜åœ¨

5xx:æœåŠ¡å™¨ä»£ç é”™è¯¯ 500  502ï¼šç½‘å…³é”™è¯¯



**å¸¸è§é¢è¯•é¢˜ï¼š**

å½“ä½ çš„æµè§ˆå™¨ä¸­åœ°å€æ è¾“å…¥åœ°å€å¹¶å›è½¦çš„ä¸€ç¬é—´åˆ°é¡µé¢èƒ½å¤Ÿå±•ç¤ºå›æ¥ï¼Œç»å†äº†ä»€ä¹ˆï¼Ÿ



### 5ã€Maven

------

**æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦å­¦ä¹ è¿™ä¸ªæŠ€æœ¯ï¼Ÿ**

1. åœ¨javawebå¼€å‘ä¸­ï¼Œéœ€è¦ä½¿ç”¨å¤§é‡çš„jaråŒ…ï¼Œè¿™äº›jaråŒ…éœ€è¦æ‰‹åŠ¨å¯¼å…¥
2. å¦‚ä½•èƒ½å¤Ÿè®©ä¸€ä¸ªä¸œè¥¿è‡ªåŠ¨å¸®æˆ‘ä»¬å¯¼å…¥å’Œé…ç½®è¿™ä¸ªjaråŒ…

ç”±æ­¤ï¼ŒMavenè¯ç”Ÿäº†ï¼



#### 5.1ã€Mavené¡¹ç›®æ¶æ„ç®¡ç†å·¥å…·

æˆ‘ä»¬ç›®å‰ç”¨å®ƒæ¥æ–¹ä¾¿å¯¼å…¥jaråŒ…çš„ï¼

Mavençš„æ ¸å¿ƒæ€æƒ³ï¼š**çº¦å®šå¤§äºé…ç½®**

- æœ‰çº¦æŸï¼Œä¸è¦å»è¿åã€‚

Mavenä¼šè§„å®šå¥½ä½ è¯¥å¦‚ä½•å»ç¼–å†™æˆ‘ä»¬çš„Javaä»£ç ï¼Œå¿…é¡»è¦æŒ‰ç…§è¿™ä¸ªè§„èŒƒæ¥ï¼›



#### 5.2ã€ä¸‹è½½å®‰è£…Maven

å®˜ç½‘ï¼šhttps://maven.apache.org/

è‡ªè¡Œä¸‹è½½ï¼ï¼ï¼

å»ºè®®ï¼šç”µè„‘ä¸Šçš„æ‰€æœ‰ç¯å¢ƒéƒ½æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œæ–¹ä¾¿ç®¡ç†ï¼



#### 5.3ã€é…ç½®ç¯å¢ƒå˜é‡

åœ¨æˆ‘ä»¬çš„ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­

é…ç½®å¦‚ä¸‹ï¼š

- M2_HOME:mavenç›®å½•ä¸‹çš„binç›®å½•
- MAVEN_HOME:mavençš„ç›®å½•
- åœ¨ç³»ç»Ÿçš„pathä¸­é…ç½®%MAVEN_HOME%\bin

![image-20220308194320546](JavaWeb.assets/image-20220308194320546.png)

æµ‹è¯•Mavenæ˜¯å¦å®‰è£…æˆåŠŸï¼Œä¿è¯å¿…é¡»é…ç½®æˆåŠŸï¼



#### 5.4ã€é˜¿é‡Œäº‘é•œåƒ

- é•œåƒï¼šmirrors
  - ä½œç”¨ï¼šåŠ é€Ÿæˆ‘ä»¬çš„ä¸‹è½½
- å›½å†…å»ºè®®ä½¿ç”¨é˜¿é‡Œäº‘çš„é•œåƒ

```xml
  <mirror>
        <id>alimaven</id>
        <mirrorOf>central</mirrorOf>
        <name>aliyun maven</name>
     	 <url>http://maven.aliyun.com/nexus/content/repositories/central/</url>
    </mirror>
```



#### 5.5ã€æœ¬åœ°ä»“åº“

åœ¨æœ¬åœ°çš„ä»“åº“ï¼Œè¿œç¨‹ä»“åº“ï¼›

**å»ºç«‹ä¸€ä¸ªæœ¬åœ°ä»“åº“ï¼š**localRepository

```xml
<localRepository>D:\java\apache-maven-3.8.4\maven-repo</localRepository>
```



#### 5.6ã€åœ¨IDEAä¸­ä½¿ç”¨Maven

1. å¯åŠ¨idea
2. åˆ›å»ºä¸€ä¸ªMavené¡¹ç›®

![image-20220308195618822](JavaWeb.assets/image-20220308195618822.png)

![image-20220308200039993](JavaWeb.assets/image-20220308200039993.png)

3.ç­‰å¾…é¡¹ç›®åˆå§‹åŒ–å®Œæ¯•

4.è§‚å¯Ÿmavenä»“åº“ä¸­å¤šäº†ä»€ä¹ˆä¸œè¥¿ï¼Ÿ

5.ideaä¸­çš„mavenè®¾ç½®

æ³¨æ„ï¼šideaé¡¹ç›®åˆ›å»ºæˆåŠŸåï¼Œçœ‹ä¸€çœ¼mavençš„é…ç½®

![image-20220308200834895](JavaWeb.assets/image-20220308200834895.png)

6.åˆ°è¿™é‡Œï¼Œåœ¨ideaä¸­é…ç½®mavenå°±å¯ä»¥ä½¿ç”¨äº†ï¼



#### 5.7ã€åˆ›å»ºä¸€ä¸ªæ™®é€šçš„mavené¡¹ç›®

![image-20220308201511313](JavaWeb.assets/image-20220308201511313.png)

è¿™ä¸ªåªæœ‰åœ¨webåº”ç”¨ä¸‹æ‰æœ‰

![image-20220308201722396](JavaWeb.assets/image-20220308201722396.png)



#### 5.8ã€æ ‡è®°æ–‡ä»¶å¤¹åŠŸèƒ½

![image-20220308201936498](JavaWeb.assets/image-20220308201936498.png)

![image-20220308202036732](JavaWeb.assets/image-20220308202036732.png)

![image-20220308202150782](JavaWeb.assets/image-20220308202150782.png)



![image-20220308202241264](JavaWeb.assets/image-20220308202241264.png)



#### 5.9ã€åœ¨ideaä¸­é…ç½®tomcat

![image-20220308202539570](JavaWeb.assets/image-20220308202539570.png)

![image-20220308202616990](JavaWeb.assets/image-20220308202616990.png)

![image-20220308202812887](JavaWeb.assets/image-20220308202812887.png)

è§£å†³è­¦å‘Šé—®é¢˜

**ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬è®¿é—®ä¸€ä¸ªç½‘ç«™ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªæ–‡ä»¶å¤¹çš„åå­—**

å¿…é¡»ï¼ï¼ï¼

![image-20220308202954999](JavaWeb.assets/image-20220308202954999.png)

![image-20220308203228879](JavaWeb.assets/image-20220308203228879.png)

![image-20220308203413241](JavaWeb.assets/image-20220308203413241.png)

![image-20220308203733011](JavaWeb.assets/image-20220308203733011.png)



#### 5.10ã€pomæ–‡ä»¶

pom.xmlæ˜¯mavençš„æ ¸å¿ƒé…ç½®æ–‡ä»¶

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!--mavenç‰ˆæœ¬çš„å¤´æ–‡ä»¶-->
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>
<!--è¿™é‡Œæ˜¯æˆ‘ä»¬åˆšæ‰é…ç½®çš„GVA-->
  <groupId>com.peng</groupId>
  <artifactId>javaweb_maven</artifactId>
  <version>1.0-SNAPSHOT</version>
<!--package:é¡¹ç›®çš„æ‰“åŒ…æ–¹å¼
jar:Javaåº”ç”¨
war:javawebåº”ç”¨
-->
  <packaging>war</packaging>

  <name>javaweb_maven Maven Webapp</name>
  <!-- FIXME change it to the project's website -->
  <url>http://www.example.com</url>
<!--é…ç½®-->
  <properties>
<!--é¡¹ç›®çš„é»˜è®¤æ„å»ºç¼–ç -->
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
<!--ç¼–è¯‘ç‰ˆæœ¬-->
    <maven.compiler.source>1.7</maven.compiler.source>
    <maven.compiler.target>1.7</maven.compiler.target>
  </properties>
<!--é¡¹ç›®ä¾èµ–-->
  <dependencies>
<!--å…·ä½“ä¾èµ–çš„jaråŒ…-->
    <dependency>
      <groupId>junit</groupId>
      <artifactId>junit</artifactId>
      <version>4.11</version>
    </dependency>
  </dependencies>
<!--é¡¹ç›®æ„å»ºç”¨çš„ä¸œè¥¿-->
  <build>
    <finalName>javaweb_maven</finalName>
    <pluginManagement><!-- lock down plugins versions to avoid using Maven defaults (may be moved to parent pom) -->
      <plugins>
        <plugin>
          <artifactId>maven-clean-plugin</artifactId>
          <version>3.1.0</version>
        </plugin>
        <!-- see http://maven.apache.org/ref/current/maven-core/default-bindings.html#Plugin_bindings_for_war_packaging -->
        <plugin>
          <artifactId>maven-resources-plugin</artifactId>
          <version>3.0.2</version>
        </plugin>
        <plugin>
          <artifactId>maven-compiler-plugin</artifactId>
          <version>3.8.0</version>
        </plugin>
        <plugin>
          <artifactId>maven-surefire-plugin</artifactId>
          <version>2.22.1</version>
        </plugin>
        <plugin>
          <artifactId>maven-war-plugin</artifactId>
          <version>3.2.2</version>
        </plugin>
        <plugin>
          <artifactId>maven-install-plugin</artifactId>
          <version>2.5.2</version>
        </plugin>
        <plugin>
          <artifactId>maven-deploy-plugin</artifactId>
          <version>2.8.2</version>
        </plugin>
      </plugins>
    </pluginManagement>
  </build>
</project>

```



![image-20220308204730471](JavaWeb.assets/image-20220308204730471.png)

mavenç”±äºå®ƒçš„çº¦å®šå¤§äºé…ç½®ï¼Œæˆ‘ä»¬ä¹‹åå¯èƒ½ä¼šé‡åˆ°æˆ‘ä»¬å†™çš„é…ç½®é—®é¢˜æ— æ³•è¢«å¯¼å‡ºæˆ–è€…ç”Ÿæ•ˆçš„é—®é¢˜ï¼Œè§£å†³æ–¹æ¡ˆï¼š

```xml
<build>
    <resources>
        <resource>
            <directory>src/main/resources</directory>
            <includes>
                <include>**/*.properties</include>
                <include>**/*.xml</include>
            </includes>
            <filtering>false</filtering>
        </resource>
        <resource>
            <directory>src/main/java</directory>
            <includes>
                <include>**/*.properties</include>
                <include>**/*.xml</include>
            </includes>
            <filtering>false</filtering>
        </resource>
    </resources>
</build>
```



#### 5.11ã€ideaæ“ä½œ

![image-20220308205241375](JavaWeb.assets/image-20220308205241375.png)



#### 5.12ã€mavenä»“åº“çš„ä½¿ç”¨

åœ°å€ï¼šhttps://mvnrepository.com/artifact/javax.servlet.jsp/javax.servlet.jsp-api/2.3.3



**æµ‹è¯•ï¼š**

```java
package com.peng.servlet;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.io.PrintWriter;

public class helloservlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        //å“åº”çš„ç±»å‹ï¼šhtml
        resp.setContentType("text/html");
        resp.setCharacterEncoding("utf-8");
        //è·å–å“åº”çš„è¾“å‡ºæµ
        PrintWriter out = resp.getWriter();
        out.println("<html>");
        out.println("<head>");
        out.println("<title>HelloWorld!</title>");
        out.println("</head>");
        out.println("<body>");
        out.println("<h1>hello,world</h1>");
        out.println("</body>");
        out.println("</html>");
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        super.doPost(req, resp);
    }
}

```

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>æˆ‘æ˜¯å¯¼èˆªæ </h1>
</body>
</html>

```

```xml
<!DOCTYPE web-app PUBLIC
 "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
 "http://java.sun.com/dtd/web-app_2_3.dtd" >

<web-app>
  <display-name>Archetype Created Web Application</display-name>
<!--web.xmlä¸­æ˜¯é…ç½®æˆ‘ä»¬webçš„æ ¸å¿ƒåº”ç”¨-->
<!--  æ³¨å†Œservlet-->
  <servlet>
    <servlet-name>helloservlet</servlet-name>
    <servlet-class>com.peng.servlet.helloservlet</servlet-class>
  </servlet>
<!-- ä¸€ä¸ªservletå¯¹åº”ä¸€ä¸ªMapping:æ˜ å°„-->
  <servlet-mapping>
    <servlet-name>helloservlet</servlet-name>
    <url-pattern>/peng</url-pattern>
  </servlet-mapping>

</web-app>

```



### 6ã€Servlet

------

#### 6.1ã€Servletç®€ä»‹

- Servletå°±æ˜¯sunå…¬å¸å¼€å‘åŠ¨æ€webçš„ä¸€é—¨æŠ€æœ¯
- sunåœ¨è¿™äº›Apiä¸­æä¾›ä¸€ä¸ªæ¥å£å«åšï¼šServlet,å¦‚æœä½ æƒ³å¼€å‘ä¸€ä¸ªServletç¨‹åºï¼Œåªéœ€è¦å®Œæˆä¸¤ä¸ªå°æ­¥éª¤ï¼š
  - ç¼–å†™ä¸€ä¸ªç±»ï¼Œå®ç°servletæ¥å£
  - æŠŠå¼€å‘å¥½çš„Javaç±»éƒ¨ç½²åˆ°webæœåŠ¡å™¨ä¸­

**æŠŠå®ç°äº†Servletæ¥å£çš„javaç¨‹åºå«åšï¼ŒServlet**



#### 6.2ã€HelloServlet

Servletæ¥å£Sunå…¬å¸æœ‰ä¸¤ä¸ªé»˜è®¤çš„å®ç°ç±»ï¼šHttpServlet,GenericServlet

1.æ„å»ºä¸€ä¸ªæ™®é€šçš„mavené¡¹ç›®ï¼Œåˆ æ‰é‡Œé¢çš„srcç›®å½•ï¼Œä»¥åæˆ‘ä»¬çš„å­¦ä¹ å°±åœ¨è¿™ä¸ªé¡¹ç›®é‡Œé¢å»ºç«‹modelè¿™ä¸ªç©ºçš„å·¥ç¨‹å°±æ˜¯mavençš„ä¸»å·¥ç¨‹ï¼›

2.å…³äºmavençˆ¶å­å·¥ç¨‹çš„ç†è§£ï¼š

çˆ¶é¡¹ç›®ä¸­ä¼šæœ‰

```xml
 <modules>
        <module>servlet_01</module>
    </modules>
```

å­é¡¹ç›®ä¼šæœ‰

```xml
<parent>
    <artifactId>javaweb_maven_01</artifactId>
    <groupId>org.example</groupId>
    <version>1.0-SNAPSHOT</version>
  </parent>
```

çˆ¶é¡¹ç›®ä¸­çš„Javaå­é¡¹ç›®å¯ä»¥ç›´æ¥ä½¿ç”¨

```java
son extends parent
```

3.mavenç¯å¢ƒä¼˜åŒ–

1. web.xmléœ€è¦æ¢æœ€æ–°çš„
2. å°†mavençš„ç»“æ„æ­å»ºå®Œæ•´

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
                         http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
         version="4.0"
         metadata-complete="true">
</web-app>

```

4.ç¼–å†™ä¸€ä¸ªServletç¨‹åº

- ç¼–å†™ä¸€ä¸ªæ™®é€šç±»
- å®ç°Servletæ¥å£,è¿™é‡Œæˆ‘ä»¬ç›´æ¥ç»§æ‰¿httpServlet

```java
package com.peng.servlet;

import javax.servlet.ServletException;
import javax.servlet.ServletOutputStream;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.io.PrintWriter;

public class helloservlet extends HttpServlet {
    //ç”±äºgetæˆ–è€…poståªæ˜¯è¯·æ±‚å®ç°çš„ä¸åŒçš„æ–¹å¼ï¼Œå¯ä»¥äº’ç›¸è°ƒç”¨ï¼Œä¸šåŠ¡é€»è¾‘éƒ½ä¸€æ ·
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
//        ServletOutputStream outputStream = resp.getOutputStream();
        PrintWriter writer = resp.getWriter();
        writer.print("hello,Servlet");
        
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        super.doPost(req, resp);
    }
}

```



5.ç¼–å†™Servletçš„æ˜ å°„

ä¸ºä»€ä¹ˆéœ€è¦æ˜ å°„ï¼šæˆ‘ä»¬å†™çš„æ—¶Javaç¨‹åºï¼Œä½†æ˜¯è¦é€šè¿‡æµè§ˆå™¨è®¿é—®ï¼Œæµè§ˆå™¨éœ€è¦è¿æ¥webæœåŠ¡å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨webæœåŠ¡ä¸­æ³¨å†Œæˆ‘ä»¬å†™çš„Servletï¼Œè¿˜éœ€ç»™ä»–ä¸€ä¸ªæµè§ˆå™¨èƒ½å¤Ÿè®¿é—®çš„è·¯å¾„ï¼›

```xml
<!--æ³¨å†Œservlet-->
    <servlet>
        <servlet-name>helloservlet</servlet-name>
        <servlet-class>com.peng.servlet.helloservlet</servlet-class>
    </servlet>
<!-- ä¸€ä¸ªservletå¯¹åº”ä¸€ä¸ªmappingï¼šæ˜ å°„ servletçš„è¯·æ±‚è·¯å¾„-->
    <servlet-mapping>
        <servlet-name>helloservlet</servlet-name>
        <url-pattern>/peng</url-pattern>
    </servlet-mapping>
```

6.é…ç½®tomcat

æ³¨æ„ï¼šé…ç½®é¡¹ç›®å‘å¸ƒçš„è·¯å¾„å°±å¯ä»¥äº†ï¼

7.å¯åŠ¨æµ‹è¯• ğŸ†—ï¼



#### 6.3ã€è¿è¡ŒåŸç†

Servletæ˜¯ç”±webæœåŠ¡å™¨è°ƒç”¨ï¼ŒwebæœåŠ¡å™¨åœ¨æ”¶åˆ°æµè§ˆå™¨è¯·æ±‚ä¹‹åï¼Œä¼šï¼š

![image-20220309190659029](JavaWeb.assets/image-20220309190659029.png)

#### 6.4ã€Mappingé—®é¢˜

1. ä¸€ä¸ªServletå¯ä»¥æŒ‡å®šä¸€ä¸ªæ˜ å°„è·¯å¾„

   ```xml
   <servlet-mapping>
           <servlet-name>helloservlet</servlet-name>
           <url-pattern>/peng</url-pattern>
       </servlet-mapping>
   ```

2. ä¸€ä¸ªServletå¯ä»¥æŒ‡å®šå¤šä¸ªæ˜ å°„è·¯å¾„

   ```xml
   <servlet-mapping>
           <servlet-name>helloservlet</servlet-name>
           <url-pattern>/peng</url-pattern>
       </servlet-mapping>
   <servlet-mapping>
           <servlet-name>helloservlet</servlet-name>
           <url-pattern>/peng1</url-pattern>
       </servlet-mapping>
   ```

   

3. ä¸€ä¸ªServletå¯ä»¥æŒ‡å®šé€šç”¨æ˜ å°„è·¯å¾„

   ```xml
   <servlet-mapping>
           <servlet-name>helloservlet</servlet-name>
           <url-pattern>/peng/*</url-pattern>
       </servlet-mapping>
   ```

   

4. é»˜è®¤è¯·æ±‚è·¯å¾„

   ```xml
   <servlet-mapping>
           <servlet-name>helloservlet</servlet-name>
           <url-pattern>/*</url-pattern>
       </servlet-mapping>
   ```

   

5. æŒ‡å®šä¸€äº›åç¼€æˆ–è€…å‰ç¼€ç­‰å¾…......

   ```xml
   <!--å¯ä»¥è‡ªå®šä¹‰åç¼€å®ç°è¯·æ±‚æ˜ å°„
   æ³¨æ„ç‚¹*å‰é¢ä¸èƒ½åŠ é¡¹ç›®æ˜ å°„çš„è·¯å¾„
   hello/asds.peng
   -->
   <servlet-mapping>
           <servlet-name>helloservlet</servlet-name>
           <url-pattern>*.peng</url-pattern>
       </servlet-mapping>
   ```

6. ä¼˜å…ˆçº§é—®é¢˜

   æŒ‡å®šäº†å›ºæœ‰çš„æ˜ å°„è·¯å¾„ä¼˜å…ˆçº§æœ€é«˜ï¼Œå¦‚æœæ‰¾ä¸åˆ°å°±ä¼šèµ°é»˜è®¤çš„å¤„ç†è¯·æ±‚ï¼›

   ```xml
   <!--404-->
       <servlet>
           <servlet-name>error</servlet-name>
           <servlet-class>com.peng.servlet.errorservlet</servlet-class>
       </servlet>
       <servlet-mapping>
           <servlet-name>error</servlet-name>
           <url-pattern>/*</url-pattern>
       </servlet-mapping>
   ```

   ```java
   package com.peng.servlet;
   
   import javax.servlet.ServletException;
   import javax.servlet.http.HttpServlet;
   import javax.servlet.http.HttpServletRequest;
   import javax.servlet.http.HttpServletResponse;
   import java.io.IOException;
   import java.io.PrintWriter;
   
   public class errorservlet extends HttpServlet {
       @Override
       protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
           resp.setContentType("text/html");
           resp.setCharacterEncoding("utf-8");
   
           PrintWriter writer = resp.getWriter();
           writer.print("<h1>404</h1>");
       }
   
       @Override
       protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
           super.doPost(req, resp);
       }
   }
   
   ```



#### 6.5ã€ServletContext

webå®¹å™¨åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œå®ƒä¼šä¸ºæ¯ä¸ªwebç¨‹åºéƒ½åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ServletContextå¯¹è±¡ï¼Œå®ƒä»£è¡¨äº†å½“å‰çš„webåº”ç”¨ï¼›

##### 1ã€å…±äº«æ•°æ®

- æˆ‘åœ¨è¿™ä¸ªServletä¸­ä¿å­˜çš„æ•°æ®ï¼Œå¯ä»¥åœ¨å¦å¤–ä¸€ä¸ªServletä¸­è·å¾—

  ```java
  public class helloservlet extends HttpServlet {
      @Override
      protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
  //        this.getInitParameter(); åˆå§‹åŒ–å‚æ•°
  //            this.getServletConfig(); servleté…ç½®
  //        this.getServletContext(); servletä¸Šä¸‹æ–‡
  
          ServletContext context = this.getServletContext();
          String username = "é¹é£"; //æ•°æ®
          context.setAttribute("username",username);// å°†ä¸€ä¸ªæ•°æ®ä¿å­˜åœ¨äº†ServletContextä¸­  åå­—ä¸ºusername   å€¼ä¸º username
      }
  }
  ```

  ```java
  public class getServlet extends HttpServlet {
      @Override
      protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
          ServletContext context = this.getServletContext();
  
          String username = (String) context.getAttribute("username");
  
          resp.setContentType("text/html");
          resp.setCharacterEncoding("utf-8");
          resp.getWriter().print("åå­—ï¼š"+username);
      }
  
      @Override
      protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
          super.doPost(req, resp);
      }
  }
  ```

  ```xml
  <?xml version="1.0" encoding="UTF-8"?>
  <web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
                           http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
           version="4.0"
           metadata-complete="true">
  
      <servlet>
          <servlet-name>hello</servlet-name>
          <servlet-class>com.peng.servlet.helloservlet</servlet-class>
      </servlet>
      <servlet-mapping>
          <servlet-name>hello</servlet-name>
          <url-pattern>/peng</url-pattern>
      </servlet-mapping>
  
      <servlet>
          <servlet-name>getc</servlet-name>
          <servlet-class>com.peng.servlet.getServlet</servlet-class>
      </servlet>
      <servlet-mapping>
          <servlet-name>getc</servlet-name>
          <url-pattern>/peng1</url-pattern>
      </servlet-mapping>
  </web-app>
  
  ```

  æµ‹è¯•è®¿é—®ç»“æœï¼›



##### 2ã€è·å–åˆå§‹åŒ–å‚æ•°

```xml
   <context-param>
        <param-name>url</param-name>
        <param-value>jdbc:mysql://localhost:3306</param-value>
    </context-param>
```

```java
public class servletdemo03 extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        ServletContext context = this.getServletContext();

        String url = context.getInitParameter("url");
        resp.getWriter().print(url);
    }
}
```

##### 3ã€è¯·æ±‚è½¬å‘

```java
   protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        System.out.println("è¿›å…¥äº†Servletdemo04");
        ServletContext context = this.getServletContext();
//        RequestDispatcher requestDispatcher = context.getRequestDispatcher("/peng2"); // è½¬å‘çš„è¯·æ±‚è·¯å¾„
//        requestDispatcher.forward(req,resp); //è°ƒç”¨forwardå®ç°è¯·æ±‚è½¬å‘
        context.getRequestDispatcher("/peng2").forward(req,resp);
    }
```

```xml
<servlet>
    <servlet-name>s4</servlet-name>
    <servlet-class>com.peng.servlet.Serveltdemo04</servlet-class>
</servlet>
<servlet-mapping>
    <servlet-name>s4</servlet-name>
    <url-pattern>/peng3</url-pattern>
</servlet-mapping>
```

![image-20220309201745354](JavaWeb.assets/image-20220309201745354.png)



##### 4ã€è¯»å–èµ„æºæ–‡ä»¶

Properties

- åœ¨Javaç›®å½•ä¸‹æ–°å»ºProperties
- åœ¨resourcesç›®å½•ä¸‹æ–°å»ºProperties

å‘ç°ï¼šéƒ½è¢«æ‰“åŒ…åˆ°äº†åŒä¸€ä¸ªè·¯å¾„ä¸‹ï¼šclasses,æˆ‘ä»¬ä¿—ç§°è¿™ä¸ªè·¯å¾„ä¸ºclasspath;

æ€è·¯ï¼šéœ€è¦ä¸€ä¸ªæ–‡ä»¶æµï¼›

```properties
username=pengfei
password=123456
```

```java
public class servletdemo05 extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        InputStream is = this.getServletContext().getResourceAsStream("/WEB-INF/classes/db.properties");
        Properties prop = new Properties();
        prop.load(is);
        String username = prop.getProperty("username");
        String password = prop.getProperty("password");

        resp.getWriter().print(username+":"+password);
    }
}
```

è®¿é—®æµ‹è¯•ğŸ†—å³å¯ï¼›



#### 6.6ã€HttpServletResponse

webæœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·çš„httpè¯·æ±‚ï¼Œé’ˆå¯¹è¿™ä¸ªè¯·æ±‚ï¼Œåˆ†åˆ«åˆ›å»ºä¸€ä¸ªä»£è¡¨è¯·æ±‚çš„HttpServletRequestå¯¹è±¡ï¼Œä»£è¡¨å“åº”çš„ä¸€ä¸ªHttpServletResponse;

- å¦‚æœè¦è·å–å®¢æˆ·ç«¯è¯·æ±‚è¿‡æ¥çš„å‚æ•°ï¼šæ‰¾HttpServletRequest
- å¦‚æœè¦ç»™å®¢æˆ·ç«¯å“åº”ä¸€äº›ä¿¡æ¯ï¼šæ‰¾HttpServletResponse

##### 1ã€ç®€å•åˆ†ç±»

è´Ÿè´£å‘æµè§ˆå™¨å‘é€æ•°æ®çš„æ–¹æ³•

```java
ServletOutputStream getOutputStream() throws IOException;

PrintWriter getWriter() throws IOException;
```

è´Ÿè´£å‘æµè§ˆå™¨å‘é€å“åº”å¤´çš„æ–¹æ³•

```java
void setCharacterEncoding(String var1);

void setContentLength(int var1);

void setContentLengthLong(long var1);

void setContentType(String var1);

void setDateHeader(String var1, long var2);

void addDateHeader(String var1, long var2);

void setHeader(String var1, String var2);

void addHeader(String var1, String var2);

void setIntHeader(String var1, int var2);

void addIntHeader(String var1, int var2);
```

å“åº”çš„çŠ¶æ€ç 

```java
 int SC_CONTINUE = 100;
    int SC_SWITCHING_PROTOCOLS = 101;
    int SC_OK = 200;
    int SC_CREATED = 201;
    int SC_ACCEPTED = 202;
    int SC_NON_AUTHORITATIVE_INFORMATION = 203;
    int SC_NO_CONTENT = 204;
    int SC_RESET_CONTENT = 205;
    int SC_PARTIAL_CONTENT = 206;
    int SC_MULTIPLE_CHOICES = 300;
    int SC_MOVED_PERMANENTLY = 301;
    int SC_MOVED_TEMPORARILY = 302;
    int SC_FOUND = 302;
    int SC_SEE_OTHER = 303;
    int SC_NOT_MODIFIED = 304;
    int SC_USE_PROXY = 305;
    int SC_TEMPORARY_REDIRECT = 307;
    int SC_BAD_REQUEST = 400;
    int SC_UNAUTHORIZED = 401;
    int SC_PAYMENT_REQUIRED = 402;
    int SC_FORBIDDEN = 403;
    int SC_NOT_FOUND = 404;
    int SC_METHOD_NOT_ALLOWED = 405;
    int SC_NOT_ACCEPTABLE = 406;
    int SC_PROXY_AUTHENTICATION_REQUIRED = 407;
    int SC_REQUEST_TIMEOUT = 408;
    int SC_CONFLICT = 409;
    int SC_GONE = 410;
    int SC_LENGTH_REQUIRED = 411;
    int SC_PRECONDITION_FAILED = 412;
    int SC_REQUEST_ENTITY_TOO_LARGE = 413;
    int SC_REQUEST_URI_TOO_LONG = 414;
    int SC_UNSUPPORTED_MEDIA_TYPE = 415;
    int SC_REQUESTED_RANGE_NOT_SATISFIABLE = 416;
    int SC_EXPECTATION_FAILED = 417;
    int SC_INTERNAL_SERVER_ERROR = 500;
    int SC_NOT_IMPLEMENTED = 501;
    int SC_BAD_GATEWAY = 502;
    int SC_SERVICE_UNAVAILABLE = 503;
    int SC_GATEWAY_TIMEOUT = 504;
    int SC_HTTP_VERSION_NOT_SUPPORTED = 505;
```

##### 2ã€ä¸‹è½½æ–‡ä»¶

1. åƒæµè§ˆå™¨è¾“å‡ºæ¶ˆæ¯ï¼ˆä¸€ç›´åœ¨è®²ï¼‰
2. ä¸‹è½½æ–‡ä»¶
   1. è¦è·å–ä¸‹è½½æ–‡ä»¶çš„è·¯å¾„
   2. ä¸‹è½½çš„æ–‡ä»¶åæ˜¯å•¥ï¼Ÿ
   3. è®¾ç½®æƒ³åŠæ³•è®©æµè§ˆå™¨èƒ½å¤Ÿæ”¯æŒä¸‹è½½æˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿
   4. è·å–ä¸‹è½½æ–‡ä»¶çš„è¾“å…¥æµ
   5. åˆ›å»ºç¼“å†²åŒº
   6. è·å–OutputStreamå¯¹è±¡
   7. å°†FileOutputStreamæµå†™å…¥åˆ°bufferç¼“å†²åŒº
   8. ä½¿ç”¨OutputStreamå°†ç¼“å†²åŒºä¸­çš„æ•°æ®è¾“å‡ºåˆ°å®¢æˆ·ç«¯ï¼

```java
package com.peng.servlet;

import javax.servlet.ServletException;
import javax.servlet.ServletOutputStream;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.FileInputStream;
import java.io.IOException;
import java.net.URLEncoder;

public class FileServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
//        1. è¦è·å–ä¸‹è½½æ–‡ä»¶çš„è·¯å¾„
            String realPath = "D:\\ideaproject\\javaweb_maven_01\\response\\target\\classes\\é¹é£.png";
            System.out.println("è¦è·å–ä¸‹è½½æ–‡ä»¶çš„è·¯å¾„:"+realPath);
//        2. ä¸‹è½½çš„æ–‡ä»¶åæ˜¯å•¥ï¼Ÿ
        String filename = realPath.substring(realPath.lastIndexOf("\\") + 1);
//        3. è®¾ç½®æƒ³åŠæ³•è®©æµè§ˆå™¨èƒ½å¤Ÿ(Content-Disposition)æ”¯æŒä¸‹è½½æˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿,è®©ä¸­æ–‡æ–‡ä»¶åURLEncoder.encodeç¼–ç ï¼Œå¦åˆ™æœ‰å¯èƒ½ä¼šä¹±ç 
        resp.setHeader("Content-Disposition","attachment;filename="+ URLEncoder.encode(filename,"utf-8"));
//        4. è·å–ä¸‹è½½æ–‡ä»¶çš„è¾“å…¥æµ
        FileInputStream in = new FileInputStream(realPath);
//        5. åˆ›å»ºç¼“å†²åŒº
        int len = 0;
        byte[] buffer = new byte[1024];
//        6. è·å–OutputStreamå¯¹è±¡
        ServletOutputStream out = resp.getOutputStream();

//        7. å°†FileOutputStreamæµå†™å…¥åˆ°bufferç¼“å†²åŒº
        while ((in.read(buffer))!=-1){
            out.write(buffer,0,len);
        }
        in.close();
        out.close();
        //        8. ä½¿ç”¨OutputStreamå°†ç¼“å†²åŒºä¸­çš„æ•°æ®è¾“å‡ºåˆ°å®¢æˆ·ç«¯ï¼
    }
```

##### 3ã€éªŒè¯ç åŠŸèƒ½

éªŒè¯ç æ€ä¹ˆæ¥çš„ï¼Ÿ

- å‰ç«¯å®ç°
- åç«¯å®ç°ï¼Œéœ€è¦ç”¨åˆ°Javaçš„å›¾ç‰‡ç±»ï¼Œç”Ÿæˆä¸€ä¸ªå›¾ç‰‡

```java
package com.peng.servlet;

import javax.imageio.ImageIO;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.awt.*;
import java.awt.image.BufferedImage;
import java.io.IOException;
import java.util.Random;

public class imageServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        //å¦‚ä½•è®©æµè§ˆå™¨3ç§’è‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡ï¼›
        resp.setHeader("refresh","3");
        //åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªå›¾ç‰‡
        BufferedImage image = new BufferedImage(80,100,BufferedImage.TYPE_INT_RGB);
        //å¾—åˆ°å›¾ç‰‡
        Graphics2D g =(Graphics2D) image.getGraphics(); // ç¬”
        //è®¾ç½®å›¾ç‰‡çš„èƒŒæ™¯é¢œè‰²
        g.setColor(Color.white);
        g.fillRect(0,0,80,20);
        //ç»™å›¾ç‰‡å†™æ•°æ®
        g.setColor(Color.blue);
        g.setFont(new Font(null,Font.BOLD,20));
        g.drawString(makenum(),0,20);

        //å‘Šè¯‰æµè§ˆå™¨è¿™ä¸ªè¯·æ±‚ç”¨å›¾ç‰‡çš„æ–¹å¼æ‰“å¼€
        resp.setContentType("image/jpeg");
        //ç½‘ç«™å­˜åœ¨ç¼“å­˜ï¼Œä¸è®©æµè§ˆå™¨ç¼“å­˜
        resp.setDateHeader("expires",-1);
        resp.setHeader("Cache-Control","no-cache");
        resp.setHeader("Pragma","no-cache");

        //æŠŠå›¾ç‰‡å†™ç»™æµè§ˆå™¨
        ImageIO.write(image,"jpg",resp.getOutputStream());
    }
    //ç”Ÿæˆéšæœºæ•°
    private String makenum(){
        Random random = new Random();
        String num = random.nextInt(99999999) + "";
        StringBuffer sb = new StringBuffer();
        for (int i = 0; i < 7-num.length(); i++) {
            sb.append("0");
        }
        String s = sb.toString() + num;
        return num;
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        super.doPost(req, resp);
    }
}

```

##### 4ã€å®ç°é‡å®šå‘

![image-20220311171034636](JavaWeb.assets/image-20220311171034636.png)

Bä¸€ä¸ªwebèµ„æºæ”¶åˆ°å®¢æˆ·ç«¯Aè¯·æ±‚åï¼ŒBä»–ä¼šé€šçŸ¥Aå®¢æˆ·ç«¯å»è®¿é—®å¦å¤–ä¸€ä¸ªwebèµ„æºCï¼Œè¿™ä¸ªè¿‡ç¨‹å«é‡å®šå‘

å¸¸è§åœºæ™¯ï¼š

- ç”¨æˆ·ç™»å½•

```java
void sendRedirect(String var1) throws IOException;
```

æµ‹è¯•ï¼š

```java
public class RedirectServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
//        resp.setHeader("Location","/red/image");
//        resp.setStatus(HttpServletResponse.SC_FOUND);
        resp.sendRedirect("/red/image");
    }
```

é¢è¯•é¢˜ï¼šè¯·ä½ èŠä¸€èŠé‡å®šå‘å’Œè½¬å‘çš„åŒºåˆ«ï¼Ÿ

ç›¸åŒç‚¹

- é¡µé¢éƒ½ä¼šå®ç°è·³è½¬

ä¸åŒç‚¹

- è¯·æ±‚è½¬å‘çš„æ—¶å€™ï¼Œurlä¸ä¼šäº§ç”Ÿå˜åŒ–
- é‡å®šå‘çš„æ—¶å€™ï¼Œurlåœ°å€æ ä¼šå‘ç”Ÿå˜åŒ–

```xml
//jsp  
<dependency>
        <groupId>javax.servlet.jsp</groupId>
        <artifactId>javax.servlet.jsp-api</artifactId>
        <version>2.3.3</version>
        <scope>provided</scope>
    </dependency>
```



```java
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        //å¤„ç†è¯·æ±‚
        String username = req.getParameter("username");
        String password = req.getParameter("password");

        System.out.println(username+" "+password);
        //é‡å®šå‘ä¸€å®šæ³¨æ„è·¯å¾„é—®é¢˜ï¼Œå¦åˆ™ä¼š404
        resp.sendRedirect("/r/success.jsp");
    }

```

```jsp

<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Title</title>
</head>
<body>
<h1>Success</h1>
</body>
</html>
```



#### 6.7ã€HttpServletRequest

HttpServletRequestä»£è¡¨å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç”¨æˆ·é€šè¿‡Httpåè®®è®¿é—®æœåŠ¡å™¨ï¼Œhttpè¯·æ±‚ä¸­çš„æ‰€æœ‰ä¿¡æ¯ä¼šè¢«å°è£…åˆ°HttpServletRequestï¼Œé€šè¿‡è¿™ä¸ªHttpServletRequestçš„æ–¹æ³•ï¼Œè·å¾—å®¢æˆ·ç«¯çš„æ‰€æœ‰ä¿¡æ¯

![image-20220313090441838](JavaWeb.assets/image-20220313090441838.png)



![image-20220313090521233](JavaWeb.assets/image-20220313090521233.png)



##### è·å–å‚æ•°,è¯·æ±‚è½¬å‘

![image-20220313090719197](JavaWeb.assets/image-20220313090719197.png)

```xml
 <servlet>
        <servlet-name>request</servlet-name>
        <servlet-class>com.peng.servlet.loginservlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>request</servlet-name>
        <url-pattern>/login</url-pattern>
    </servlet-mapping>
```

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>ç™»å½•</title>
</head>
<body>
<h1>ç™»å½•</h1>
<div>
<%--è¿™é‡Œè¡¨å•è¡¨ç¤ºçš„æ„æ€ï¼šä»¥postæ–¹å¼æäº¤è¡¨å•ï¼Œæäº¤åˆ°æˆ‘ä»¬çš„loginè¯·æ±‚--%>
    <form action="${pageContext.request.contextPath}/login" method="post">
        ç”¨æˆ·åï¼š<input type="text" name="username"> <br>
        å¯†ç ï¼š<input type="password" name="password"> <br>
        çˆ±å¥½ï¼š
        <input type="checkbox" name="hobby" value="å¥³å­©">å¥³å­©
        <input type="checkbox" name="hobby" value="ä»£ç ">ä»£ç 
        <input type="checkbox" name="hobby" value="å”±æ­Œ">å”±æ­Œ
        <input type="checkbox" name="hobby" value="ç”µå½±">ç”µå½±
        <br>
        <input type="submit">
    </form>

</div>
</body>
</html>

```

```jsp

<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>ç™»å½•æˆåŠŸ</title>
</head>
<body>
<p>å¥–åŠ±ï¼š</p>
<img src="image/015.jpg">
</body>
</html>

```

```java
package com.peng.servlet;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.util.Arrays;

public class loginservlet extends HttpServlet {

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        req.setCharacterEncoding("utf-8");
        resp.setCharacterEncoding("utf-8");
        String username = req.getParameter("username");
        String password = req.getParameter("password");
        String[] hobby = req.getParameterValues("hobby");

        //åå°æ¥æ”¶ä¹±ç é—®é¢˜
        System.out.println("===========================");
        System.out.println(username);
        System.out.println(password);
        System.out.println(Arrays.toString(hobby));
        System.out.println("===========================");

        System.out.println(req.getContextPath());
        //é€šè¿‡è¯·æ±‚è½¬å‘
        // è¿™é‡Œçš„/ ä»£è¡¨å½“å‰çš„webåº”ç”¨
        req.getRequestDispatcher("/success.jsp").forward(req,resp);
    }
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req,resp);
    }
}
```

**é¢è¯•é¢˜ï¼šè¯·ä½ èŠä¸€èŠé‡å®šå‘å’Œè½¬å‘çš„åŒºåˆ«ï¼Ÿ**

ç›¸åŒç‚¹

- é¡µé¢éƒ½ä¼šå®ç°è·³è½¬

ä¸åŒç‚¹

- è¯·æ±‚è½¬å‘çš„æ—¶å€™ï¼Œurlä¸ä¼šäº§ç”Ÿå˜åŒ–  307
- é‡å®šå‘çš„æ—¶å€™ï¼Œurlåœ°å€æ ä¼šå‘ç”Ÿå˜åŒ– 302



### 7ã€Cookieã€Session

------

#### 7.1ã€ä¼šè¯

**ä¼šè¯ï¼š**ç”¨æˆ·æ‰“å¼€ä¸€ä¸ªæµè§ˆå™¨ï¼Œç‚¹å‡»äº†å¾ˆå¤šè¶…é“¾æ¥ï¼Œè®¿é—®å¤šä¸ªwebèµ„æºï¼Œå…³é—­æµè§ˆå™¨ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç§°ä¹‹ä¸ºä¼šè¯

**æœ‰çŠ¶æ€ä¼šè¯ï¼š**ä¸€ä¸ªåŒå­¦æ¥è¿‡æ•™å®¤ï¼Œä¸‹æ¬¡å†æ¥æ•™å®¤ï¼Œæˆ‘ä»¬ä¼šçŸ¥é“è¿™ä½åŒå­¦ï¼Œæ›¾ç»æ¥è¿‡ï¼Œç§°ä¹‹ä¸ºæœ‰çŠ¶æ€ä¼šè¯

**ä½ èƒ½æ€ä¹ˆè¯æ˜ä½ æ˜¯å±±ä¸œçš„å­¦ç”Ÿï¼Ÿ**

ä½   å±±ä¸œ

1. å­¦ç±    å±±ä¸œå­¦æ ¡åŠçš„å­¦ç±
2. å­¦æ ¡ç™»è®°  å±±ä¸œæ ‡è®°ä½ åœ¨è¿™

**ä¸€ä¸ªç½‘ç«™ï¼Œæ€ä¹ˆè¯æ˜ä½ æ¥è¿‡ï¼Ÿ**

å®¢æˆ·ç«¯   æœåŠ¡ç«¯

1. æœåŠ¡ç«¯ç»™å®¢æˆ·ç«¯ä¸€ä¸ªä¿¡ä»¶ï¼Œå®¢æˆ·ç«¯ä¸‹æ¬¡è®¿é—®æœåŠ¡ç«¯å¸¦ä¸Šä¿¡ä»¶å°±å¯ä»¥äº†ï¼›cookie
2. æœåŠ¡å™¨ç™»è®°ä½ æ¥è¿‡äº†ï¼Œä¸‹æ¬¡ä½ æ¥çš„æ—¶å€™æˆ‘æ¥åŒ¹é…ä½ ï¼›



#### 7.2ã€ä¿å­˜ä¼šè¯çš„ä¸¤ç§æŠ€æœ¯

**cookie**

- å®¢æˆ·ç«¯æŠ€æœ¯ï¼ˆå“åº”ï¼Œè¯·æ±‚ï¼‰

**session**

- æœåŠ¡å™¨æŠ€æœ¯ï¼Œåˆ©ç”¨è¿™ä¸ªæŠ€æœ¯ï¼Œå¯ä»¥ä¿å­˜ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯ï¼Ÿæˆ‘ä»¬å¯ä»¥æŠŠä¿¡æ¯æˆ–è€…æ•°æ®æ”¾åœ¨sessionä¸­ï¼



å¸¸è§åœºæ™¯ï¼šç½‘ç«™ç™»å½•ä¹‹åï¼Œä½ ä¸‹æ¬¡ä¸ç”¨å†ç™»å½•äº†ï¼Œç¬¬äºŒæ¬¡è®¿é—®å°±ç›´æ¥ä¸Šå»äº†ï¼



#### 7.3ã€Cookie

![image-20220313145815308](JavaWeb.assets/image-20220313145815308.png)

1. ä»è¯·æ±‚ä¸­æ‹¿åˆ°cookieä¿¡æ¯
2. æœåŠ¡å™¨å“åº”ç»™å®¢æˆ·ç«¯cookie

```java
Cookie[] cookies = req.getCookies();// è·å¾—cookie

cookie.getName(); //è·å¾—cookieä¸­çš„key

cookie.getValue(); //è·å¾—cookieä¸­çš„å€¼value

new Cookie("lastlogintime", System.currentTimeMillis() + ""); //æ–°å»ºä¸€ä¸ªcookie

cookie.setMaxAge(24*60*60); //è®¾ç½®cookieçš„æœ‰æ•ˆæ—¶é—´

 resp.addCookie(cookie); // å“åº”ç»™å®¢æˆ·ç«¯ä¸€ä¸ªcookie
```



**cookie:ä¸€èˆ¬ä¼šä¿å­˜åœ¨æœ¬åœ°çš„ç”¨æˆ·ç›®å½•ä¸‹appdata;**



ä¸€ä¸ªç½‘ç«™cookieæ˜¯å¦å­˜åœ¨ä¸Šé™ï¼**èŠèŠç»†èŠ‚é—®é¢˜**

- ä¸€ä¸ªcookieåªèƒ½ä¿å­˜ä¸€ä¸ªä¿¡æ¯
- ä¸€ä¸ªwebç«™ç‚¹å¯ä»¥ç»™æµè§ˆå™¨å‘é€å¤šä¸ªcookieï¼Œæœ€å¤šå­˜æ”¾20ä¸ªcookie
- Cookieå¤§å°æœ‰é™åˆ¶4kb;
- 300ä¸ªcookieæµè§ˆå™¨ä¸Šé™



åˆ é™¤Cookie:

- ä¸è®¾ç½®æœ‰æ•ˆæœŸï¼Œå…³é—­æµè§ˆå™¨ï¼Œè‡ªåŠ¨å¤±æ•ˆï¼›
- è®¾ç½®æœ‰æ•ˆæœŸæ—¶é—´ä¸º0ï¼›

```java
package com.peng.servlet;

import javax.servlet.ServletException;
import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

public class cookiedemo01 extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        //åˆ›å»ºä¸€ä¸ªcookie åå­—å¿…é¡»å’Œè¦åˆ é™¤çš„åå­—ä¸€è‡´
        Cookie cookie = new Cookie("lastlogintime", System.currentTimeMillis() + "");
        //å°†cookieæœ‰æ•ˆæ—¶é—´è®¾ç½®ä¸º0
        cookie.setMaxAge(0);
        resp.addCookie(cookie);
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        super.doPost(req, resp);
    }
}

```



```java
//è§£ç 
out.write(URLDecoder.decode(cookie.getValue(),"UTF-8"));

//ç¼–ç 
Cookie cookie = new Cookie("name",URLEncoder.encode("é¹é£"ï¼Œ"utf-8"));
```





#### 7.4ã€Session(é‡ç‚¹)

![image-20220313150014590](JavaWeb.assets/image-20220313150014590.png)

ä»€ä¹ˆæ˜¯Session:

- æœåŠ¡å™¨ä¼šç»™æ¯ä¸€ä¸ªç”¨æˆ·åˆ›å»ºä¸€ä¸ªSessionå¯¹è±¡
- ä¸€ä¸ªsessionç‹¬å ä¸€ä¸ªæµè§ˆå™¨ï¼Œåªè¦æµè§ˆå™¨æ²¡æœ‰å…³é—­ï¼Œè¿™ä¸ªSessionå°±å­˜åœ¨
- ç”¨æˆ·ç™»å½•ä¹‹åï¼Œæ•´ä¸ªç½‘ç«™éƒ½å¯ä»¥è®¿é—®ï¼--ã€‹ä¿å­˜ç”¨æˆ·çš„ä¿¡æ¯ï¼›ä¿å­˜è´­ç‰©è½¦çš„ä¿¡æ¯....



Sessionå’ŒCookieçš„åŒºåˆ«ï¼š

- Cookieæ˜¯æŠŠç”¨æˆ·çš„æ•°æ®å†™ç»™ç”¨æˆ·çš„æµè§ˆå™¨ï¼Œæµè§ˆå™¨ä¿å­˜ï¼ˆå¯ä»¥ä¿å­˜å¤šä¸ªï¼‰
- SessionæŠŠç”¨æˆ·çš„æ•°æ®å†™åˆ°ç”¨æˆ·ç‹¬å Sessionä¸­ï¼ŒæœåŠ¡å™¨ç«¯ä¿å­˜ï¼ˆä¿å­˜é‡è¦çš„ä¿¡æ¯ï¼Œå‡å°‘æœåŠ¡å™¨èµ„æºçš„æµªè´¹ï¼‰
- Sessionå¯¹è±¡ç”±æœåŠ¡åˆ›å»ºï¼›



ä½¿ç”¨åœºæ™¯ï¼š

- ä¿å­˜ä¸€ä¸ªç™»å½•ç”¨æˆ·çš„ä¿¡æ¯ï¼›
- è´­ç‰©è½¦ä¿¡æ¯ï¼›
- åœ¨æ•´ä¸ªç½‘ç«™ä¸­ç»å¸¸ä¼šä½¿ç”¨çš„æ•°æ®ï¼Œæˆ‘ä»¬å°†å®ƒä¿å­˜åœ¨Sessionä¸­



ä½¿ç”¨Session:

```java
package com.peng.servlet;

import com.peng.pojo.Person;

import javax.servlet.ServletException;
import javax.servlet.http.*;
import java.io.IOException;

public class Sessiondemo extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        //è§£å†³ä¹±ç é—®é¢˜
        req.setCharacterEncoding("utf-8");
        resp.setCharacterEncoding("utf-8");
        resp.setContentType("text/html;charset=utf-8");
        //å¾—åˆ°Session
        HttpSession session = req.getSession();

        //ç»™Sessionä¸­å­˜ä¸œè¥¿
        session.setAttribute("name",new Person("é¹é£",23));
        //è·å–Sessionçš„id
        String id = session.getId();

        //åˆ¤æ–­Sessionæ˜¯ä¸æ˜¯æ–°åˆ›å»º
        if (session.isNew()){
            resp.getWriter().write("sessionåˆ›å»ºæˆåŠŸï¼Œid:"+id);
        }else {
            resp.getWriter().write("sessionå·²ç»åœ¨æœåŠ¡å™¨ä¸­å­˜åœ¨äº†ï¼Œid:"+id);
        }
        //sessionåˆ›å»ºçš„æ—¶å€™åšäº†ä»€ä¹ˆäº‹æƒ…
//        Cookie cookie = new Cookie("JSESSIONID",id);
//        resp.addCookie(cookie);
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        super.doPost(req, resp);
    }
}

```



```java
package com.peng.servlet;

import com.peng.pojo.Person;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;
import java.io.IOException;

public class Sessiondemo01 extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        //è§£å†³ä¹±ç é—®é¢˜
        req.setCharacterEncoding("utf-8");
        resp.setCharacterEncoding("utf-8");
        resp.setContentType("text/html;charset=utf-8");
        //å¾—åˆ°Session
        HttpSession session = req.getSession();

        Person person = (Person) session.getAttribute("name");
        System.out.println(person.toString());
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        super.doPost(req, resp);
    }
}

```



```java
package com.peng.servlet;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;
import java.io.IOException;

public class sessiondemo02 extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        HttpSession session = req.getSession();
        //æ‰‹åŠ¨æ³¨é”€session
        session.removeAttribute("name");
        session.invalidate();
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        super.doPost(req, resp);
    }
}

```

**ä¼šè¯è‡ªåŠ¨è¿‡æœŸï¼šweb.xmlé…ç½®**

```xml
<!-- è®¾ç½®sessioné»˜è®¤çš„å¤±æ•ˆæ—¶é—´-->
<session-config>
    <!--15åˆ†é’ŸåSessionè‡ªåŠ¨å¤±æ•ˆï¼Œä»¥åˆ†é’Ÿä¸ºå•ä½-->
    <session-timeout>15</session-timeout>
</session-config>
```



![image-20220313150225376](JavaWeb.assets/image-20220313150225376.png)



### 8ã€JSP

------

#### 8.1ã€ä»€ä¹ˆæ˜¯JSP

java Server Pages:JavaæœåŠ¡å™¨ç«¯é¡µé¢ï¼Œä¹Ÿå’ŒServletä¸€æ ·ç”¨äºå¼€å‘åŠ¨æ€webæŠ€æœ¯ï¼

æœ€å¤§çš„ç‰¹ç‚¹ï¼š

- å†™JSPå°±åƒåœ¨å†™HTML
- åŒºåˆ«ï¼š
  - Htmlåªç»™ç”¨æˆ·æä¾›é™æ€çš„æ•°æ®
  - JSPé¡µé¢ä¸­å¯ä»¥åµŒå…¥javaä»£ç ï¼Œä¸ºç”¨æˆ·æä¾›åŠ¨æ€æ•°æ®ï¼›



#### 8.2ã€JSPåŸç†

æ€è·¯ï¼šJSPåˆ°åº•æ€ä¹ˆæ‰§è¡Œçš„ï¼

- ä»£ç å±‚é¢æ²¡æœ‰ä»»ä½•é—®é¢˜
- æœåŠ¡å™¨å†…éƒ¨å·¥ä½œ
  - tomcatä¸­æœ‰ä¸€ä¸ªworkç›®å½•
  - ideaä¸­ä½¿ç”¨Tomcatçš„æ—¶å€™ä¼šåœ¨ideaçš„tomcatä¸­äº§ç”Ÿä¸€ä¸ªworkç›®å½•



**æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œä¸ç®¡è®¿é—®ä»€ä¹ˆèµ„æºï¼Œå…¶å®éƒ½æ˜¯åœ¨è®¿é—®Servlet**

JSPæœ€ç»ˆä¹Ÿä¼šè¢«è½¬æ¢æˆä¸€ä¸ªJavaç±»

**JSPæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªServlet**

```java
//åˆå§‹åŒ–
	public void _jspInit(){}
//é”€æ¯
	public void _jspDestroy(){}
//JSPService
	public void _jspService(.HttpServletRequest request,HttpServletResponse response)
```

1. åˆ¤æ–­è¯·æ±‚
2. å†…ç½®ä¸€äº›å¯¹è±¡

```java
final javax.servlet.jsp.PageContext pageContext; //é¡µé¢ä¸Šä¸‹æ–‡
javax.servlet.http.HttpSession session = null;  //session
final javax.servlet.ServletContext application; 
// applicationContext
final javax.servlet.ServletConfig config; //config
javax.servlet.jsp.JspWriter out = null;//out
final java.lang.Object page = this;//page: å½“å‰
HttpServletRequest request //è¯·æ±‚
HttpServletResponse response //å“åº”
```

3.è¾“å‡ºé¡µé¢å‰å¢åŠ çš„ä»£ç 

```java
response.setContentType("text/html"); //è®¾ç½®å“åº”çš„é¡µé¢ç±»å‹
pageContext = _jspxFactory.getPageContext(this, request, response,null, true, 8192, true); 
_jspx_page_context = pageContext;
application = pageContext.getServletContext();
config = pageContext.getServletConfig();
session = pageContext.getSession();
out = pageContext.getOut();
_jspx_out = out;
```

4.ä»¥ä¸Šçš„è¿™äº›ä¸ªå¯¹è±¡æˆ‘ä»¬å¯ä»¥åœ¨jspé¡µé¢ä¸­ç›´æ¥ä½¿ç”¨ï¼

![image-20220313174543484](JavaWeb.assets/image-20220313174543484.png)

åœ¨jspé¡µé¢ä¸­ï¼›

åªè¦æ˜¯Javaä»£ç å°±ä¼šåŸå°ä¸åŠ¨çš„è¾“å‡ºï¼›

å¦‚æœæ˜¯htmlä»£ç ï¼Œå°±ä¼šè¢«è½¬æ¢ä¸ºï¼š

```java
out.write("<html>\r\n");
```

è¿™æ ·çš„æ ¼å¼ï¼Œè¾“å‡ºåˆ°å‰ç«¯ï¼›



#### 8.3ã€JSPåŸºç¡€è¯­æ³•

```xml
    <dependencies>
        <!-- https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api -->
        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>javax.servlet-api</artifactId>
            <version>4.0.1</version>
            <scope>provided</scope>
        </dependency>
        <!-- https://mvnrepository.com/artifact/javax.servlet.jsp/javax.servlet.jsp-api -->
        <dependency>
            <groupId>javax.servlet.jsp</groupId>
            <artifactId>javax.servlet.jsp-api</artifactId>
            <version>2.3.3</version>
            <scope>provided</scope>
        </dependency>
        <!-- https://mvnrepository.com/artifact/javax.servlet.jsp.jstl/jstl-api -->
        <dependency>
<!--            jstlè¡¨è¾¾å¼çš„ä¾èµ–-->
            <groupId>javax.servlet.jsp.jstl</groupId>
            <artifactId>jstl-api</artifactId>
            <version>1.2</version>
        </dependency>
        <!-- https://mvnrepository.com/artifact/taglibs/standard -->
        <dependency>
            <groupId>taglibs</groupId>
            <artifactId>standard</artifactId>
            <version>1.1.2</version>
        </dependency>

    </dependencies>
```

ä»»ä½•è¯­è¨€éƒ½æœ‰è‡ªå·±çš„è¯­æ³•ï¼ŒJavaä¸­æœ‰ï¼ŒJSPä½œä¸ºJavaæŠ€æœ¯çš„ä¸€ç§åº”ç”¨ï¼Œå®ƒæ‹¥æœ‰ä¸€äº›è‡ªå·±æ‰©å……çš„è¯­æ³•ï¼ˆäº†è§£ï¼ŒçŸ¥é“å³å¯ï¼ï¼‰ï¼ŒJavaæ‰€æœ‰è¯­æ³•éƒ½æ”¯æŒï¼



##### **JSPè¡¨è¾¾å¼**

```jsp
<%--jspè¡¨è¾¾å¼
ä½œç”¨ï¼šç”¨æ¥å°†ç¨‹åºçš„è¾“å‡ºï¼Œè¾“å‡ºåˆ°å®¢æˆ·ç«¯
<%= å˜é‡æˆ–è€…è¡¨è¾¾å¼%>
--%>
<%= new java.util.Date()%>
```



##### **jspè„šæœ¬ç‰‡æ®µ**

```jsp
<%--jspè„šæœ¬ç‰‡æ®µ--%>
<%
  int sum = 0;
  for (int i = 0; i <=100; i++) {
    sum+=i;
  }
  out.println("<h1>Sum="+sum+"</h1>");
%>
```



è„šæœ¬ç‰‡æ®µçš„å†å®ç°

```jsp
<%
  int x = 10;
  out.print(x);
%>
<p>è¿™æ˜¯ä¸€ä¸ªjspæ–‡æ¡£</p>
<%
  int y = 2;
  out.println(y);
%>

  <hr>

<%--  åœ¨ä»£ç ä¸­åµŒå…¥htmlå…ƒç´ --%>
  <%
    for (int i = 0; i < 5; i++) {
      %>
<h1>hello,world <%=i%></h1>
<%
    }
  %>
```



##### JSPå£°æ˜

```jsp
<%!
    static{
        System.out.println("Loadingservlet!");
    }

    private int globaVar = 0;
    public void peng(){
        System.out.println("è¿›å…¥äº†peng!");
    }
%>
```



JSPå£°æ˜ï¼šä¼šè¢«ç¼–è¯‘åˆ°JSPç”ŸæˆJavaçš„ç±»ä¸­ï¼å…¶ä»–çš„ï¼Œå°±ä¼šè¢«ç”Ÿæˆåˆ°_jspServiceæ–¹æ³•ä¸­ï¼



åœ¨JSP,åµŒå…¥Javaä»£ç å³å¯ï¼

```jsp
<%%>
<%=%>
<%!%>
<%--æ³¨é‡Š--%>
```

jspçš„æ³¨é‡Šï¼Œä¸ä¼šåœ¨å®¢æˆ·ç«¯æ˜¾ç¤ºï¼Œhtmlçš„æ³¨é‡Šå¯ä»¥è¢«çœ‹åˆ°



#### 8.4ã€JSPæŒ‡ä»¤

```jsp
<%@ page ...%>

<%@include file=""%>

<%--@includeä¼šå°†ä¸¤ä¸ªé¡µé¢åˆäºŒä¸ºä¸€--%>
    <%@include file="common/header.jsp"%>
    <h1>ç½‘é¡µä¸»ä½“</h1>
    <%@include file="common/footer.jsp"%>
<hr>

<%--jspæ ‡ç­¾ jsp:include æ‹¼æ¥é¡µé¢  æœ¬è´¨è¿˜æ˜¯ä¸‰ä¸ª--%>
<jsp:include page="/common/header.jsp"/>
    <h1>ç½‘é¡µä¸»ä½“</h1>
<jsp:include page="/common/footer.jsp"/>
```

é”™è¯¯é¡µé¢

```xml
<error-page>
    <error-code>404</error-code>
    <location>/error/404.jsp</location>
</error-page>

<error-page>
    <error-code>500</error-code>
    <location>/error/500.jsp</location>
</error-page>
```



#### 8.5ã€9å¤§å†…ç½®å¯¹è±¡

- PageContext  å­˜ä¸œè¥¿
- Request  å­˜ä¸œè¥¿
- Response
- Session  å­˜ä¸œè¥¿
- Application [ServletContext] å­˜ä¸œè¥¿
- config [ServletConfig] 
- out
- page  åŸºæœ¬ä¸ç”¨äº†è§£
- exception

```jsp

<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Title</title>
</head>
<body>
<%--å†…ç½®å¯¹è±¡--%>

<%
    pageContext.setAttribute("name1","é¹é£1"); // ä¿å­˜çš„æ•°æ®åªåœ¨ä¸€ä¸ªé¡µé¢ä¸­æœ‰æ•ˆ
    request.setAttribute("name2","é¹é£2"); //ä¿å­˜çš„æ•°æ®åªåœ¨ä¸€æ¬¡è¯·æ±‚ä¸­æœ‰æ•ˆï¼Œè¯·æ±‚è½¬å‘ä¼šæºå¸¦è¿™ä¸ªæ•°æ®
    session.setAttribute("name3","é¹é£3"); //ä¿å­˜çš„æ•°æ®åªåœ¨ä¸€æ¬¡ä¼šè¯ä¸­æœ‰æ•ˆï¼Œä»æ‰“å¼€æµè§ˆå™¨åˆ°å…³é—­æµè§ˆå™¨
    application.setAttribute("name4","é¹é£4");//ä¿å­˜çš„æ•°æ®åªæœåŠ¡å™¨ä¸­æœ‰æ•ˆï¼Œä»æ‰“å¼€æœåŠ¡å™¨åˆ°å…³é—­æœåŠ¡å™¨
%>
<%--è„šæœ¬ç‰‡æ®µä¸­çš„ä»£ç ï¼Œä¼šåŸå°ä¸åŠ¨çš„ç”Ÿæˆåˆ°jsp.javaä¸­
è¦æ±‚ï¼šè¿™é‡Œé¢çš„ä»£ç ï¼›å¿…é¡»ä¿è¯Javaè¯­æ³•çš„æ­£ç¡®æ€§
--%>
<%
//é€šè¿‡pageContextå–å‡ºæˆ‘ä»¬ä¿å­˜çš„å€¼,æˆ‘ä»¬é€šè¿‡å¯»æ‰¾æ–¹å¼
    //ä»åº•å±‚åˆ°é«˜å±‚ï¼ˆä½œç”¨åŸŸï¼‰page-->request-->session-->application
    String name1 = (String) pageContext.findAttribute("name1");
    String name2 = (String) pageContext.findAttribute("name2");
    String name3 = (String) pageContext.findAttribute("name3");
    String name4 = (String) pageContext.findAttribute("name4");
    String name5 = (String) pageContext.findAttribute("name5");
%>
<%--ä½¿ç”¨elè¡¨è¾¾å¼è¾“å‡º ${}--%>
<h1>å–å‡ºçš„å€¼ä¸ºï¼š</h1>
<h3>${name1}</h3>
<h3>${name2}</h3>
<h3>${name3}</h3>
<h3>${name4}</h3>
<h3><%=name5%></h3>

</body>
</html>

```

requestï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œäº§ç”Ÿçš„æ•°æ®ï¼Œç”¨æˆ·çœ‹å®Œå°±æ²¡ç”¨äº†ï¼Œæ¯”å¦‚ï¼šæ–°é—»ï¼Œç”¨æˆ·çœ‹å®Œæ²¡ç”¨çš„ï¼

sessionï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œäº§ç”Ÿçš„æ•°æ®ï¼Œç”¨æˆ·ç”¨å®Œä¸€ä¼šè¿˜æœ‰ç”¨ï¼Œæ¯”å¦‚ï¼šè´­ç‰©è½¦ï¼›

applicationï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œäº§ç”Ÿçš„æ•°æ®ï¼Œä¸€ä¸ªç”¨æˆ·ç”¨å®Œäº†ï¼Œå…¶ä»–ç”¨æˆ·è¿˜å¯èƒ½ä½¿ç”¨ï¼Œæ¯”å¦‚ï¼šèŠå¤©æ•°æ®ï¼›

![image-20220314194342732](JavaWeb.assets/image-20220314194342732.png)



#### 8.6ã€JSPæ ‡ç­¾ã€JSTLæ ‡ç­¾ã€ELè¡¨è¾¾å¼

```xml
<!-- https://mvnrepository.com/artifact/javax.servlet.jsp.jstl/jstl-api -->
<dependency>
    <!--            jstlè¡¨è¾¾å¼çš„ä¾èµ–-->
    <groupId>javax.servlet.jsp.jstl</groupId>
    <artifactId>jstl-api</artifactId>
    <version>1.2</version>
</dependency>
<!-- https://mvnrepository.com/artifact/taglibs/standard -->
<dependency>
    <groupId>taglibs</groupId>
    <artifactId>standard</artifactId>
    <version>1.1.2</version>
</dependency>
```



ELè¡¨è¾¾å¼ï¼š${}

- **è·å–æ•°æ®**
- **æ‰§è¡Œè¿ç®—**
- **è·å–webå¼€å‘çš„å¸¸ç”¨å¯¹è±¡**



**jspæ ‡ç­¾**

```jsp
<%--
http://localhost:8080/jsptag.jsp?name=pengfei&age=23
--%>
    <jsp:forward page="/jsptag1.jsp">
        <jsp:param name="name" value="pengfei"/>
        <jsp:param name="age" value="23"/>
    </jsp:forward>
```

```jsp
<%--å–å‚æ•°--%>
å§“åï¼š<%=request.getParameter("name")%>
å¹´é¾„ï¼š<%=request.getParameter("age")%>
```



**JSTLè¡¨è¾¾å¼**

jstlæ ‡ç­¾åº“çš„ä½¿ç”¨å°±æ˜¯ä¸ºäº†å¼¥è¡¥HTMLæ ‡ç­¾çš„ä¸è¶³ï¼›å®ƒè‡ªå®šä¹‰è®¸å¤šæ ‡ç­¾ï¼Œå¯ä»¥ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼Œæ ‡ç­¾çš„åŠŸèƒ½å’ŒJavaä»£ç ä¸€æ ·ï¼

**æ ¸å¿ƒæ ‡ç­¾ï¼ˆæŒæ¡éƒ¨åˆ†ï¼‰**

**æ ¼å¼åŒ–æ ‡ç­¾**

**SQLæ ‡ç­¾**

**XMLæ ‡ç­¾**



**JSTLæ ‡ç­¾åº“ä½¿ç”¨æ­¥éª¤**

- å¼•å…¥å¯¹åº”çš„taglib
- ä½¿ç”¨å…¶ä¸­çš„æ–¹æ³•
- **åœ¨tomcatä¹Ÿéœ€è¦å¼•å…¥jstlçš„åŒ…ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼šjstlè§£æé”™è¯¯**



```jsp
<%--å¼•å…¥jstlæ ¸å¿ƒæ ‡ç­¾åº“ï¼Œ--%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Title</title>
</head>
<body>
<h4>ifæµ‹è¯•</h4>
<hr>
<form action="coreif.jsp" method="get">
<%--
    ELè¡¨è¾¾å¼è·å–è¡¨å•ä¸­çš„æ•°æ®
    ${param.å‚æ•°å}
--%>
    <input type="text" name="username" value="${param.username}">
    <input type="submit" value="ç™»å½•">
</form>

<%--åˆ¤æ–­å¦‚æœæäº¤çš„ç”¨æˆ·åæ˜¯ç®¡ç†å‘˜ï¼Œåˆ™ç™»å½•æˆåŠŸ--%>
<c:if test="${param.username=='admin'}" var="isAdmin">
    <c:out value="ç®¡ç†å‘˜æ¬¢è¿æ‚¨"></c:out>
</c:if>
<%--è‡ªé—­å’Œæ ‡ç­¾--%>
<c:out value="${isAdmin}"></c:out>
</body>
</html>

```

```jsp
<%--å®šä¹‰ä¸€ä¸ªå˜é‡score,å€¼ä¸º85--%>
<c:set var="score" value="85"></c:set>

<c:choose>
    <c:when test="${score>=90}">
        ä½ çš„æˆç»©ä¸ºä¼˜ç§€
    </c:when>
    <c:when test="${score>=80}">
        ä½ çš„æˆç»©ä¸ºè‰¯å¥½
    </c:when>
    <c:when test="${score>=70}">
        ä½ çš„æˆç»©ä¸ºä¸€èˆ¬
    </c:when>
    <c:when test="${score<=60}">
        ä½ çš„æˆç»©ä¸ºä¸åŠæ ¼
    </c:when>
</c:choose>
```

```jsp
<%
    ArrayList<String> people = new ArrayList<String>();
    people.add(0,"å¼ ä¸‰");
    people.add(1,"æå››");
    people.add(2,"ç‹äº”");
    people.add(3,"å¼ æŸ³");

  request.setAttribute("list",people);
%>
<%--
var,æ¯ä¸€æ¬¡éå†å‡ºæ¥çš„å˜é‡
item,è¦éå†çš„å¯¹è±¡
begin,å“ªé‡Œå¼€å§‹
end,åˆ°å“ªé‡Œ
step, æ­¥é•¿
--%>
<c:forEach var="people" items="${list}">
    <c:out value="${people}"/> <br>
</c:forEach>
<hr>

<c:forEach var="people" items="${list}" begin="0" end="2" step="1">
    <c:out value="${people}"/> <br>
</c:forEach>
```



### 9ã€javaBean

------

å®ä½“ç±»

JavaBeanæœ‰ç‰¹å®šçš„å†™æ³•ï¼š

- å¿…é¡»è¦æœ‰ä¸€ä¸ªæ— å‚æ„é€ 
- å±æ€§å¿…é¡»ç§æœ‰åŒ–
- å¿…é¡»æœ‰å¯¹åº”çš„get\setæ–¹æ³•ï¼›

ä¸€èˆ¬ç”¨æ¥å’Œæ•°æ®åº“çš„å­—æ®µåšæ˜ å°„ ORMï¼›

ORM:å¯¹è±¡å…³ç³»æ˜ å°„

- è¡¨-->ç±»
- å­—æ®µ-->å±æ€§
- è¡Œè®°å½•-->å¯¹è±¡

**peopleè¡¨**

| id   | name | age  | address |
| ---- | ---- | ---- | ------- |
| 1    | é¹é£ | 23   | èŠåŸ    |
| 2    | é¹å“¥ | 15   | èŠåŸ    |
| 3    | é¹é¹ | 12   | èŠåŸ    |

```java
class people{
    private int id;
    private String name;
    private int age;
    private String adress;
}

class A{
    new People(1,"é¹é£",3,"èŠåŸ")ï¼›
}
```

```java
package com.peng.pojo;

// å®ä½“ç±» æˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯å’Œæ•°æ®åº“ä¸­çš„è¡¨ç»“æ„ä¸€ä¸€å¯¹åº”
public class People {
    private int id;
    private String name;
    private int age;
    private String adress;

    public People(){}
    public People(int id, String name, int age, String adress) {
        this.id = id;
        this.name = name;
        this.age = age;
        this.adress = adress;
    }

    public int getId() {
        return id;
    }

    public void setId(int id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }

    public String getAdress() {
        return adress;
    }

    public void setAdress(String adress) {
        this.adress = adress;
    }
}

```

```jsp
<%@ page import="com.peng.pojo.People" %>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Title</title>
</head>
<body>
<%
//    People people = new People();
//    people.setAdress();
//    people.setId();
//    people.setAge();
//    people.setName();
%>
<%--<%= people.getAdress()%>--%>
<jsp:useBean id="people" class="com.peng.pojo.People" scope="page"/>

<jsp:setProperty name="people" property="id" value="1"/>
<jsp:setProperty name="people" property="name" value="é¹é£"/>
<jsp:setProperty name="people" property="age" value="23"/>
<jsp:setProperty name="people" property="adress" value="èŠåŸ"/>

id:<jsp:getProperty name="people" property="id"/>
å§“åï¼š<jsp:getProperty name="people" property="name"/>
å¹´é¾„ï¼š<jsp:getProperty name="people" property="age"/>
åœ°å€ï¼š<jsp:getProperty name="people" property="adress"/>
</body>
</html>

```





### 10ã€MVCä¸‰å±‚æ¶æ„

------

ä»€ä¹ˆæ˜¯MVC:Model View Controller æ¨¡å‹ã€è§†å›¾ã€æ§åˆ¶å™¨

#### 10.1ã€æ—©äº›å¹´

![image-20220315183900924](JavaWeb.assets/image-20220315183900924.png)

ç”¨æˆ·ç›´æ¥è®¿é—®æ§åˆ¶å±‚ï¼Œæ§åˆ¶å±‚å°±å¯ä»¥ç›´æ¥æ“ä½œæ•°æ®åº“ï¼›

```java
servlet--CRUD-->æ•°æ®åº“
    å¼Šç«¯ï¼šç¨‹åºååˆ†è‡ƒè‚¿ï¼Œä¸åˆ©äºç»´æŠ¤  servletçš„ä»£ç ä¸­ï¼šå¤„ç†è¯·æ±‚ã€å“åº”ã€è§†å›¾è·³è½¬ã€å¤„ç†JDBCã€å¤„ç†ä¸šåŠ¡ä»£ç ã€å¤„ç†é€»è¾‘ä»£ç 

    æ¶æ„ï¼šæ²¡æœ‰ä»€ä¹ˆæ˜¯åŠ ä¸€å±‚è§£å†³ä¸äº†çš„ï¼
    ç¨‹åºå‘˜è°ƒç”¨
    |
    JDBC
    |
    MYSQL Oracle SqlServer
```

#### 10.2ã€MVCä¸‰å±‚æ¶æ„

![image-20220315184829212](JavaWeb.assets/image-20220315184829212.png)



Model

- ä¸šåŠ¡å¤„ç†ï¼šä¸šåŠ¡é€»è¾‘ï¼ˆServiceï¼‰
- æ•°æ®æŒä¹…å±‚ï¼šCEUD (Dao)

View

- å±•ç¤ºæ•°æ®
- æä¾›é“¾æ¥å‘èµ·Servletè¯·æ±‚ï¼ˆaï¼Œfrom,img...ï¼‰

Controller ï¼ˆServletï¼‰

- æ¥æ”¶ç”¨æˆ·çš„è¯·æ±‚ï¼šï¼ˆrequestï¼šè¯·æ±‚å‚æ•°ã€Sessionä¿¡æ¯...ï¼‰

- äº¤ç»™ä¸šåŠ¡å±‚å¤„ç†å¯¹åº”çš„ä»£ç 

- æ§åˆ¶è§†å›¾çš„è·³è½¬

  ```
  ç™»å½•-->æ¥æ”¶ç”¨æˆ·çš„ç™»å½•è¯·æ±‚-->å¤„ç†ç”¨æˆ·çš„è¯·æ±‚ï¼ˆè·å–ç”¨æˆ·ç™»å½•çš„å‚æ•°ï¼Œusernameï¼Œpasswordï¼‰-->äº¤ç»™ä¸šåŠ¡å±‚å¤„ç†ç™»å½•ä¸šåŠ¡ï¼ˆåˆ¤æ–­ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®ï¼šäº‹åŠ¡ï¼‰-->Daoå±‚æŸ¥è¯¢ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡®-->æ•°æ®åº“
  ```



### 11ã€Filterï¼ˆé‡ç‚¹ï¼‰

------

Filter:è¿‡æ»¤å™¨ï¼Œç”¨æ¥è¿‡æ»¤ç½‘ç«™çš„æ•°æ®ï¼›

- å¤„ç†ä¸­æ–‡ä¹±ç 
- ç™»å½•éªŒè¯...

![image-20220315185920491](JavaWeb.assets/image-20220315185920491.png)

Filterå¼€å‘æ­¥éª¤ï¼š

1. å¯¼åŒ…

2. ç¼–å†™è¿‡æ»¤å™¨

   1. å¯¼åŒ…ä¸è¦é”™
   2. å®ç°Filteræ¥å£ï¼Œé‡å†™å¯¹åº”çš„æ–¹æ³•å³å¯

   ```java
   package com.peng.filter;
   
   import javax.servlet.*;
   import java.io.IOException;
   
   public class CharacterEncodingFilter implements Filter {
       //åˆå§‹åŒ– webæœåŠ¡å™¨å¯åŠ¨ï¼Œå°±å·²ç»åˆå§‹åŒ–äº†ï¼Œéšæ—¶ç­‰å¾…è¿‡æ»¤å¯¹è±¡å¯åŠ¨
       @Override
       public void init(FilterConfig filterConfig) throws ServletException {
           System.out.println("CharacterEncodingå·²ç»åˆå§‹åŒ–äº†");
       }
   
       @Override
       public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
           //Chain ï¼šé“¾
   //        è¿‡æ»¤å™¨ä¸­çš„æ‰€æœ‰ä»£ç ï¼Œåœ¨è¿‡æ»¤ç‰¹å®šè¯·æ±‚çš„æ—¶å€™éƒ½ä¼šæ‰§è¡Œ
   //        å¿…é¡»è¦è®©è¿‡æ»¤å™¨ç»§ç»­æ‰§è¡Œ filterChain.doFilter(servletRequest,servletResponse);
   //
           servletRequest.setCharacterEncoding("utf-8");
           servletResponse.setCharacterEncoding("utf-8");
           servletResponse.setContentType("text/html;charset=utf-8");
   
           System.out.println("CharacterEncodingæ‰§è¡Œå‰");
           filterChain.doFilter(servletRequest,servletResponse);//è®©æˆ‘ä»¬çš„è¯·æ±‚ç»§ç»­èµ°ï¼Œå¦‚æœä¸å†™ï¼Œç¨‹åºåˆ°è¿™é‡Œå°±è¢«æ‹¦æˆªåœæ­¢äº†
           System.out.println("CharacterEncodingæ‰§è¡Œå");
       }
       //é”€æ¯ webæœåŠ¡å™¨å…³é—­çš„æ—¶å€™ï¼Œè¿‡æ»¤è¢«é”€æ¯
       @Override
       public void destroy() {
           System.out.println("CharacterEncodingå·²ç»é”€æ¯äº†äº†");
       }
   }
   
   ```

3. åœ¨web.xmlä¸­é…ç½®Filter

   ```xml
   <filter>
       <filter-name>CharacterEcodingFilter</filter-name>
       <filter-class>com.peng.filter.CharacterEncodingFilter</filter-class>
   </filter>
   <filter-mapping>
       <filter-name>CharacterEcodingFilter</filter-name>
       <!-- åªè¦æ˜¯/servletä¸‹çš„ä»»ä½•è¯·æ±‚ï¼Œéƒ½ä¼šç»è¿‡è¿™ä¸ªè¿‡æ»¤å™¨-->
       <url-pattern>/servlet/*</url-pattern>
   </filter-mapping>
   ```



### 12ã€ç›‘å¬å™¨

------

å®ç°ä¸€ä¸ªç›‘å¬å™¨çš„æ¥å£ï¼›ï¼ˆæœ‰Nç§ï¼‰

1. ç¼–å†™ä¸€ä¸ªç›‘å¬å™¨

â€‹	å®ç°ç›‘å¬å™¨é‡Œçš„æ¥å£

```java
package com.peng.listener;

import javax.servlet.ServletContext;
import javax.servlet.http.HttpSessionEvent;
import javax.servlet.http.HttpSessionListener;

//ç»Ÿè®¡ç½‘ç«™åœ¨çº¿äººæ•°ï¼šç»Ÿè®¡session
public class OnlineCountListener implements HttpSessionListener {
    //åˆ›å»ºsessionç›‘å¬ çœ‹ä½ çš„ä¸€ä¸¾ä¸€åŠ¨
//    ä¸€æ—¦åˆ›å»ºSessionå°±ä¼šè§¦å‘ä¸€æ¬¡è¿™ä¸ªäº‹ä»¶ï¼
    @Override
    public void sessionCreated(HttpSessionEvent httpSessionEvent) {
        ServletContext ctx = httpSessionEvent.getSession().getServletContext();
        System.out.println(httpSessionEvent.getSession().getId());
        Integer onlineCount = (Integer) ctx.getAttribute("OnlineCount");
        if (onlineCount == null){
            onlineCount = 1;
        }else {
            int count = onlineCount.intValue();
            onlineCount = count+1;
        }
        ctx.setAttribute("OnlineCount",onlineCount);
    }

    //é”€æ¯sessionç›‘å¬
    //    ä¸€æ—¦é”€æ¯Sessionå°±ä¼šè§¦å‘ä¸€æ¬¡è¿™ä¸ªäº‹ä»¶ï¼
    @Override
    public void sessionDestroyed(HttpSessionEvent httpSessionEvent) {
        ServletContext ctx = httpSessionEvent.getSession().getServletContext();
        Integer onlineCount = (Integer) ctx.getAttribute("OnlineCount");
        if (onlineCount == null){
            onlineCount = 0;
        }else {
            int count = onlineCount.intValue();
            onlineCount = count-1;
        }
        ctx.setAttribute("OnlineCount",onlineCount);
    }
//    Session é”€æ¯ï¼š
//    æ‰‹åŠ¨é”€æ¯ getSession().invalidate();
//    è‡ªåŠ¨é”€æ¯
}

```

```jsp
  <h1>å½“å‰æœ‰<span style="color: aqua"><%=this.getServletConfig().getServletContext().getAttribute("OnlineCount")%></span>äººåœ¨çº¿</h1>
```



2.åœ¨web.xmlç§æ³¨å†Œç›‘å¬å™¨

```xml
<!--    æ³¨å†Œç›‘å¬å™¨-->
<listener>
    <listener-class>com.peng.listener.OnlineCountListener</listener-class>
</listener>

<session-config>
    <session-timeout>1</session-timeout>
</session-config>
```

3.çœ‹æƒ…å†µæ˜¯å¦ä½¿ç”¨ï¼



### 13ã€è¿‡æ»¤å™¨ã€ç›‘å¬å™¨å¸¸è§åº”ç”¨

------

**ç›‘å¬å™¨ï¼šGUIç¼–ç¨‹ä¸­ç»å¸¸ä½¿ç”¨ï¼›**

```java
package com.peng.listener;

import java.awt.*;
import java.awt.event.WindowAdapter;
import java.awt.event.WindowEvent;

public class test {
    public static void main(String[] args) {
        Frame frame = new Frame("ä¸­ç§‹å¿«ä¹"); //æ–°å»ºä¸€ä¸ªçª—ä½“
        Panel panel = new Panel(null); // é¢æ¿

        frame.setLayout(null); //è®¾ç½®çª—ä½“çš„å¸ƒå±€

        frame.setBounds(300,300,500,500);
        frame.setBackground(new Color(0,0,255)); // è®¾ç½®èƒŒæ™¯é¢œè‰²

        panel.setBounds(50,50,300,300);
        panel.setBackground(new Color(0,255,0));

        frame.add(panel);

        frame.setVisible(true);

        //ç›‘å¬äº‹ä»¶ï¼Œå…³é—­äº‹ä»¶
        frame.addWindowListener(new WindowAdapter() {
            @Override
            public void windowClosing(WindowEvent e) {
                System.out.println("å…³é—­ing");
                System.exit(0);
            }
        });
    }
}

```



ç”¨æˆ·ç™»å½•ä¹‹åæ‰èƒ½è¿›å…¥ä¸»é¡µï¼ç”¨æˆ·æ³¨é”€åå°±ä¸èƒ½è¿›å…¥ä¸»é¡µäº†ï¼ˆæ‹¦æˆªå™¨ï¼‰

1. ç”¨æˆ·ç™»å½•ä¹‹åï¼Œå‘Sessionä¸­æ”¾å…¥ç”¨æˆ·çš„æ•°æ®
2. è¿›å…¥ä¸»é¡µçš„æ—¶å€™è¦åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å·²ç»ç™»å½•ï¼›è¦æ±‚ï¼šåœ¨è¿‡æ»¤å™¨ä¸­ä½¿ç”¨

```java
package com.peng.filter;

import com.peng.util.Constant;

import javax.servlet.*;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

public class SysFilter implements Filter {
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {

    }

    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
        // ServletRequest  HttpServletRequest
        HttpServletRequest request = (HttpServletRequest) servletRequest;
        HttpServletResponse response = (HttpServletResponse) servletResponse;


        if (request.getSession().getAttribute(Constant.USER_SESSION) == null){
            response.sendRedirect("/error.jsp");
        }

        filterChain.doFilter(servletRequest,servletResponse);
    }

    @Override
    public void destroy() {

    }
}
```

```java
package com.peng.util;

public class Constant {
    public final static String USER_SESSION = "USER_SESSION";
}
```

**ç™»å½•**

```java
package com.peng.servlet;

import com.peng.util.Constant;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

public class LoginServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
       //è·å–å‰ç«¯è¯·æ±‚çš„å‚æ•°
        String username = req.getParameter("username");
        if (username.equals("admin")){
            //ç™»å½•æˆåŠŸ
            req.getSession().setAttribute(Constant.USER_SESSION,req.getSession().getId());
            resp.sendRedirect("/sys/success.jsp");
        }else {
            //ç™»å½•å¤±è´¥
            resp.sendRedirect("/error.jsp");
        }    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req, resp);
    }
}
```

```jsp
<h1>ç™»å½•</h1>
<form action="/servlet/login" method="post">
    <input type="text" name="username">
    <input type="submit">
</form>
```

**æ³¨é”€**

```java
package com.peng.servlet;

import com.peng.util.Constant;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

public class LogoutServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        Object user_session = req.getSession().getAttribute(Constant.USER_SESSION);

        if (user_session!=null){
            req.getSession().removeAttribute(Constant.USER_SESSION);
            resp.sendRedirect("/login.jsp");
        }else {
            resp.sendRedirect("/login.jsp");
        }
    }

    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req, resp);
    }
}
```

```jsp
<h1>ä¸»é¡µ</h1>
<p><a href="/servlet/logout">æ³¨é”€</a></p>
```

**é”™è¯¯**

```jsp
<h1>é”™è¯¯</h1>
<h3>æ²¡æœ‰æƒé™æˆ–å¯†ç é”™è¯¯</h3>

<a href="/login.jsp">è¿”å›ç™»å½•é¡µé¢</a>
```



### 14ã€JDBC

------

ä»€ä¹ˆæ˜¯JDBC:javaè¿æ¥æ•°æ®åº“ï¼

![image-20220316152236608](JavaWeb.assets/image-20220316152236608.png)

éœ€è¦jaråŒ…çš„æ”¯æŒï¼š

- java.sql
- javax.sql
- mysql-conneter-java...  è¿æ¥é©±åŠ¨ï¼ˆå¿…é¡»è¦å¯¼ï¼‰



**å®éªŒç¯å¢ƒæ­å»º**

```sql
CREATE TABLE users(
id INT PRIMARY KEY,
`name` VARCHAR(40),
`password` VARCHAR(40),
email VARCHAR(60),
birthday DATE

);

INSERT INTO users(id,`name`,`password`,email,birthday)
VALUES(1,'é¹é£','123456','zsa@qq.com','2000-01-01');

INSERT INTO users(id,`name`,`password`,email,birthday)
VALUES(2,'æå››','123456','zs@qq.com','2000-02-01');

INSERT INTO users(id,`name`,`password`,email,birthday)
VALUES(3,'ç‹äº”','123456','zsas@qq.com','2020-01-01');
```

å¯¼å…¥æ•°æ®åº“ä¾èµ–

```xml
<dependencies>
    <dependency>
        <!--mysqlçš„é©±åŠ¨-->
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
        <version>8.0.28</version>
    </dependency>
</dependencies>
```

ideaä¸­è¿æ¥æ•°æ®åº“





**JDBCå›ºå®šæ­¥éª¤**

1. åŠ è½½é©±åŠ¨
2. è¿æ¥æ•°æ®åº“
3. å‘æ•°æ®åº“å‘é€Sqlçš„å¯¹è±¡ Statement :CRUD
4. ç¼–å†™SQL(æ ¹æ®ä¸šåŠ¡ï¼Œä¸åŒçš„SQL)
5. æ‰§è¡ŒSQL
6. å…³é—­è¿æ¥



```java
package com.peng.test;

import java.sql.*;

public class testjdbc {
    public static void main(String[] args) throws ClassNotFoundException, SQLException {
        //é…ç½®è¯´æ˜
        //useUnicode=true&characterEncoding=utf-8è§£å†³ä¸­æ–‡ä¹±ç 
        String url = "jdbc:mysql://localhost:3306/jdbc1?useUnicode=true&characterEncoding=utf-8";
        String username = "root";
        String password = "";
        //åŠ è½½é©±åŠ¨
        Class.forName("com.mysql.cj.jdbc.Driver");

        //è·å–æ•°æ®åº“è¿æ¥ ä»£è¡¨æ•°æ®åº“
        Connection connection = DriverManager.getConnection(url, username, password);
        //å‘æ•°æ®åº“å‘é€Sqlçš„å¯¹è±¡ Statement :CRUD
        Statement statement = connection.createStatement();
        //ç¼–å†™SQL

        String sql = "select * from users";

        //æ‰§è¡ŒæŸ¥è¯¢SQLï¼Œè¿”å›ä¸€ä¸ªResultSet ç»“æœé›†
        ResultSet resultSet = statement.executeQuery(sql);

        while (resultSet.next()){
            System.out.println("id="+resultSet.getObject("id"));
            System.out.println("name="+resultSet.getObject("name"));
            System.out.println("password="+resultSet.getObject("password"));
            System.out.println("email="+resultSet.getObject("email"));
            System.out.println("birthday="+resultSet.getObject("birthday"));
        }
        //å…³é—­è¿æ¥é‡Šæ”¾èµ„æº å…ˆå¼€åå…³

        resultSet.close();
        statement.close();
        connection.close();
    }
}
```



é¢„ç¼–è¯‘SQL

```java
package com.peng.test;

import java.sql.*;

public class testjdbc1 {
    public static void main(String[] args) throws ClassNotFoundException, SQLException {
        //é…ç½®è¯´æ˜
        //useUnicode=true&characterEncoding=utf-8è§£å†³ä¸­æ–‡ä¹±ç 
        String url = "jdbc:mysql://localhost:3306/jdbc1?useUnicode=true&characterEncoding=utf-8";
        String username = "root";
        String password = "";
        //åŠ è½½é©±åŠ¨
        Class.forName("com.mysql.cj.jdbc.Driver");

        //è·å–æ•°æ®åº“è¿æ¥ ä»£è¡¨æ•°æ®åº“
        Connection connection = DriverManager.getConnection(url, username, password);
        //ç¼–å†™SQL
        String sql = "insert into users(id, name, password, email, birthday) values (?,?,?,?,?);";
        //é¢„ç¼–è¯‘
        PreparedStatement preparedStatement = connection.prepareStatement(sql);

        preparedStatement.setInt(1,4);// ç»™ç¬¬ä¸€ä¸ªå ä½ç¬¦çš„å€¼èµ‹å€¼ä¸º1
        preparedStatement.setString(2,"é¹é£1");
        preparedStatement.setString(3,"1234567");
        preparedStatement.setString(4,"asd@qq.com");
        preparedStatement.setDate(5,new Date(new java.util.Date().getTime()));

        //æ‰§è¡Œsql
        int i = preparedStatement.executeUpdate();

        if (i>0){
            System.out.println("æ’å…¥æˆåŠŸ");
        }
        //å…³é—­è¿æ¥é‡Šæ”¾èµ„æº å…ˆå¼€åå…³
        preparedStatement.close();
        connection.close();
    }
}

```



**äº‹åŠ¡**

è¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ï¼

ACIDåŸåˆ™ï¼šä¿è¯æ•°æ®çš„å®‰å…¨ã€‚

```java
å¼€å¯äº‹åŠ¡
äº‹åŠ¡æäº¤  commit()
äº‹åŠ¡å›æ»š  rollbackï¼ˆï¼‰
å…³é—­äº‹åŠ¡

è½¬è´¦ï¼š
A:1000
B:1000

A(900) -- 100--> B(1100)
```



**Junitå•å…ƒæµ‹è¯•**

ä¾èµ–

```xml
<dependency>
    <!--å•å…ƒæµ‹è¯•-->
    <groupId>junit</groupId>
    <artifactId>junit</artifactId>
    <version>4.13.2</version>
</dependency>
```

ç®€å•ä½¿ç”¨

@Testæ³¨è§£åªæœ‰åœ¨æ–¹æ³•ä¸Šæœ‰æ•ˆï¼Œåªè¦åŠ äº†è¿™ä¸ªæ³¨è§£çš„æ–¹æ³•ï¼Œå°±å¯ä»¥ç›´æ¥è¿è¡Œ

```java
@Test
public void test(){
    System.out.println("hello");
}
```

![image-20220316162326338](JavaWeb.assets/image-20220316162326338.png)

å¤±è´¥çš„æ—¶å€™

![image-20220316162458071](JavaWeb.assets/image-20220316162458071.png)



æ­å»ºä¸€ä¸ªç¯å¢ƒ

```java
package com.peng.test;

import org.junit.Test;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

public class testjdbc2 {

    @Test
    public void test() {
        //é…ç½®è¯´æ˜
        //useUnicode=true&characterEncoding=utf-8è§£å†³ä¸­æ–‡ä¹±ç 
        String url = "jdbc:mysql://localhost:3306/jdbc1?useUnicode=true&characterEncoding=utf-8";
        String username = "root";
        String password = "";
        Connection connection =null;
                //åŠ è½½é©±åŠ¨
        try{
        Class.forName("com.mysql.cj.jdbc.Driver");

        //è·å–æ•°æ®åº“è¿æ¥ ä»£è¡¨æ•°æ®åº“
       connection = DriverManager.getConnection(url, username, password);
        //é€šçŸ¥æ•°æ®åº“å¼€å¯äº‹åŠ¡ false:å¼€å¯
        connection.setAutoCommit(false);
        String sql = "update account set money = money-100 where name='A'";
        connection.prepareStatement(sql).executeUpdate();

        //åˆ¶é€ é”™è¯¯
//        int i = 1/0;
        String sql1 = "update account set money = money+100 where name='B'";
        connection.prepareStatement(sql1).executeUpdate();

        connection.commit();//ä»¥ä¸Šä¸¤å¤©SQLéƒ½æ‰§è¡ŒæˆåŠŸäº†å°±æäº¤äº‹åŠ¡
        System.out.println("æ‰§è¡ŒæˆåŠŸ");}
        catch (Exception e){
            try {
                //å¦‚æœå‡ºç°å¼‚å¸¸ï¼Œå°±é€šçŸ¥æ•°æ®åº“å›æ»šäº‹åŠ¡
                connection.rollback();
            } catch (SQLException ex) {
                ex.printStackTrace();
            }
            e.printStackTrace();
        }finally {
            try {
                connection.close();
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }
    }}

```





### 15ã€æ–‡ä»¶ä¸Šä¼ 

------

#### 1.å‡†å¤‡å·¥ä½œ

å¯¹äºæ–‡ä»¶ä¸Šä¼ ï¼Œæµè§ˆå™¨åœ¨ä¸Šä¼ çš„è¿‡ç¨‹ä¸­æ˜¯å°†æ–‡ä»¶ä»¥æµçš„å½¢å¼æäº¤åˆ°æœåŠ¡å™¨ç«¯çš„

ä¸€èˆ¬é€‰æ‹©é‡‡ç”¨apacheçš„å¼€æºå·¥å…·common-fileuploadè¿™ä¸ªæ–‡ä»¶ä¸Šä¼ ç»„ä»¶

common-fileuploadæ˜¯ä¾èµ–äºcommon-ioè¿™ä¸ªåŒ…çš„ï¼Œæ‰€ä»¥è¿˜éœ€è¦ä¸‹è½½è¿™ä¸ªåŒ…



**æˆ‘ä»¬ä¸‹è½½æœ€æ–°çš„jaråŒ…**

- https://mvnrepository.com/artifact/commons-fileupload/commons-fileupload
- https://mvnrepository.com/artifact/commons-io/commons-io

**maven:**

```xml
<!-- https://mvnrepository.com/artifact/commons-io/commons-io -->
<dependency>
    <groupId>commons-io</groupId>
    <artifactId>commons-io</artifactId>
    <version>2.11.0</version>
</dependency>

<!-- https://mvnrepository.com/artifact/commons-fileupload/commons-fileupload -->
<dependency>
    <groupId>commons-fileupload</groupId>
    <artifactId>commons-fileupload</artifactId>
    <version>1.4</version>
</dependency>
```



åœ¨Javawebé¡¹ç›®ä¸­å¯¼å…¥jaråŒ…

![image-20220320104926404](JavaWeb.assets/image-20220320104926404.png)

#### 2.å®ç”¨ç±»ä»‹ç»

==æ–‡ä»¶ä¸Šä¼ çš„æ³¨æ„äº‹é¡¹ï¼ˆé¢è¯•é¢˜ï¼‰==

1. ä¸ºä¿è¯æœåŠ¡å™¨å®‰å…¨ï¼Œä¸Šä¼ æ–‡ä»¶åº”è¯¥æ”¾åœ¨å¤–ç•Œæ— æ³•ç›´æ¥è®¿é—®çš„ç›®å½•ä¸‹ï¼Œæ¯”å¦‚æ”¾äºWEB-INFç›®å½•ä¸‹
2. ä¸ºé˜²æ­¢æ–‡ä»¶è¦†ç›–çš„ç°è±¡å‘ç”Ÿï¼Œè¦ä¸ºä¸Šä¼ æ–‡ä»¶äº§ç”Ÿä¸€ä¸ªå”¯ä¸€çš„æ–‡ä»¶å
3. è¦é™åˆ¶ä¸Šä¼ æ–‡ä»¶çš„æœ€å¤§å€¼
4. å¯ä»¥é™åˆ¶ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹ï¼Œåœ¨æ”¶åˆ°ä¸Šä¼ æ–‡ä»¶åæ—¶ï¼Œåˆ¤æ–­åç¼€åæ˜¯å¦åˆæ³•



==éœ€è¦ç”¨åˆ°çš„ç±»è¯¦è§£==

**ServletFileUpload**è´Ÿè´£å¤„ç†ä¸Šä¼ çš„æ–‡ä»¶æ•°æ®ï¼Œå¹¶å°†è¡¨å•ä¸­æ¯ä¸ªè¾“å…¥é¡¹è£…æˆä¸€ä¸ªFileitemå¯¹è±¡ï¼Œåœ¨ä½¿ç”¨**ServletFileUpload**å¯¹è±¡è§£æè¯·æ±‚æ—¶éœ€è¦**DiskFileitemFactory**å¯¹è±¡ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¿›è¡Œè§£æå·¥ä½œå‰æ„é€ å¥½**DiskFileitemFactory**å¯¹è±¡ï¼Œé€šè¿‡**ServletFileUpload**å¯¹è±¡çš„æ„é€ æ–¹æ³•æˆ–**setFileitemFactory**()æ–¹æ³•è®¾ç½®**ServletFileUpload**å¯¹è±¡çš„**fileitemFactory**å±æ€§



**Fileitemç±»**

åœ¨HTMLé¡µé¢inputå¿…é¡»æœ‰ name`<input type = "file" name = "filename">`



è¡¨å•å¦‚æœåŒ…å«ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ è¾“å…¥é¡¹çš„è¯ï¼Œè¿™ä¸ªè¡¨å•çš„enctypeå±æ€§å°±å¿…é¡»è®¾ç½®ä¸ºmultipart/form-data

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
  <head>
    <title>$Title$</title>
  </head>
  <body>
<%--  é€šè¿‡è¡¨å•ä¸Šä¼ æ–‡ä»¶
  getï¼šä¸Šä¼ æ–‡ä»¶å¤§å°æœ‰é™åˆ¶
  post:ä¸Šä¼ æ–‡ä»¶å¤§å°æ²¡æœ‰é™åˆ¶
--%>
<%--${pageContext.request.contextPath}è·å–æœåŠ¡å™¨è·¯å¾„--%>
  <form action="${pageContext.request.contextPath}/upload.do" method="post" enctype="multipart/form-data">
    ä¸Šä¼ ç”¨æˆ·ï¼š<input type="text" name="username"> <br>
       <p><input type="file" name="file1"></p>
       <p><input type="file" name="file1"></p>

       <p><input type="submit"> | <input type="reset"></p>
  </form>
  </body>
</html>
```

æµè§ˆå™¨è¡¨å•çš„ç±»å‹å¦‚æœä¸ºmultipart/form-dataï¼Œåœ¨æœåŠ¡å™¨ç«¯æƒ³è¦è·å–æ•°æ®å°±è¦é€šè¿‡æµã€‚



```java
//isFormFieldæ–¹æ³•ç”¨äºåˆ¤æ–­FileItemç±»å¯¹è±¡å°è£…çš„æ•°æ®æ˜¯ä¸€ä¸ªæ™®é€šæ–‡æœ¬è¡¨å•
//è¿˜æ˜¯ä¸€ä¸ªæ–‡ä»¶è¡¨å•ï¼Œå¦‚æœæ˜¯æ™®é€šè¡¨å•å­—æ®µåˆ™è¿”å›true,å¦åˆ™è¿”å›false
boolean isFormField();

//getFieldNameæ–¹æ³•ç”¨äºè¿”å›è¡¨å•æ ‡ç­¾nameå±æ€§çš„å€¼
String getFieldName();
//getStringæ–¹æ³•ç”¨äºå°†FileItemå¯¹è±¡ä¸­ä¿å­˜çš„æ•°æ®æµå†…å®¹ä»¥ä¸€ä¸ªå­—ç¬¦ä¸²è¿”å›
String getString();

//getNameæ–¹æ³•ç”¨äºè·å–æ–‡ä»¶ä¸Šä¼ å­—æ®µä¸­çš„æ–‡ä»¶å
String getName();

//ä»¥æµçš„å½¢å¼è¿”å›ä¸Šä¼ æ–‡ä»¶çš„æ•°æ®å†…å®¹
InputStream getInputStream()
    
//deletæ–¹æ³•ç”¨æ¥æ¸…ç©ºFileItemç±»å¯¹è±¡ä¸­å­˜æ”¾çš„ä¸»ä½“å†…å®¹
//å¦‚æœä¸»ä½“å†…å®¹è¢«ä¿å­˜åœ¨ä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œdeleteæ–¹æ³•å°†åˆ é™¤è¯¥ä¸´æ—¶æ–‡ä»¶
 void delete();
```



**ServletFileUploadç±»**

ServletFileUploadè´Ÿè´£å¤„ç†ä¸Šä¼ çš„æ–‡ä»¶æ•°æ®ï¼Œå¹¶å°†è¡¨å•ä¸­æ¯ä¸ªè¾“å…¥é¡¹å°è£…æˆä¸€ä¸ªFileItemå¯¹è±¡ä¸­ï¼Œä½¿ç”¨å…¶parseRequest(HttpServletRequest)æ–¹æ³•å¯ä»¥å°†é€šè¿‡è¡¨å•ä¸­æ¯ä¸€ä¸ªHTMLæ ‡ç­¾æäº¤çš„æ•°æ®å°è£…æˆä¸€ä¸ªFileItemå¯¹è±¡ï¼Œç„¶åä»¥Liståˆ—è¡¨çš„å½¢å¼è¿”å›ã€‚ä½¿ç”¨è¯¥æ–¹æ³•å¤„ç†ä¸Šä¼ æ–‡ä»¶ç®€å•æ˜“ç”¨ã€‚



#### 3.ä»£ç ç¼–å†™

```java
package com.peng;

import org.apache.commons.fileupload.FileItem;
import org.apache.commons.fileupload.FileUploadException;
import org.apache.commons.fileupload.ProgressListener;
import org.apache.commons.fileupload.disk.DiskFileItemFactory;
import org.apache.commons.fileupload.servlet.ServletFileUpload;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.util.List;
import java.util.UUID;

public class FileServlet extends HttpServlet {

    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        //åˆ¤æ–­ä¸Šä¼ çš„è¡¨å•æ˜¯æ™®é€šè¡¨å•è¿˜æ˜¯å¸¦æ–‡ä»¶çš„è¡¨å•ï¼Œæ˜¯è¿”å›true,å¦è¿”å›falseï¼›
        if (!ServletFileUpload.isMultipartContent(request)){
            return;//å¦‚æœè¿™æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶æˆ‘ä»¬ç›´æ¥è¿”å›
        }//å¦‚æœé€šè¿‡äº†è¿™ä¸ªifï¼Œè¯´æ˜æˆ‘ä»¬çš„è¡¨å•æ˜¯å¸¦æ–‡ä»¶ä¸Šä¼ çš„

        //åˆ›å»ºä¸Šä¼ æ–‡ä»¶çš„ä¿å­˜ç›®å½•ï¼Œä¸ºäº†å®‰å…¨å»ºè®®åœ¨WEB-INFç›®å½•ä¸‹ï¼Œç”¨æˆ·æ— æ³•è®¿é—®
        String uploadpath = this.getServletContext().getRealPath("WEB-INF/Upload");//è·å–ä¸Šä¼ æ–‡ä»¶çš„ä¿å­˜è·¯å¾„
        File uploadfile = new File(uploadpath);
        if (!uploadfile.exists()){
            uploadfile.mkdir();//å¦‚æœç›®å½•ä¸å­˜åœ¨å°±åˆ›å»ºè¿™æ ·ä¸€ä¸ªç›®å½•
        }

        //ä¸´æ—¶æ–‡ä»¶
        //ä¸´æ—¶è·¯å¾„ï¼Œå¦‚æœä¸Šä¼ çš„æ–‡ä»¶è¶…è¿‡é¢„æœŸçš„å¤§å°ï¼Œæˆ‘ä»¬å°†å®ƒå­˜æ”¾åˆ°ä¸€ä¸ªä¸´æ—¶ç›®å½•ä¸­ï¼Œè¿‡å‡ å¤©è‡ªåŠ¨åˆ é™¤ï¼Œæˆ–è€…æé†’ç”¨æˆ·è½¬å­˜ä¸ºæ°¸ä¹…
        String tmppath = this.getServletContext().getRealPath("WEB-INF/tmp");
        File file = new File(tmppath);
        if (!file.exists()){
            file.mkdir();//å¦‚æœç›®å½•ä¸å­˜åœ¨å°±åˆ›å»ºè¿™æ ·ä¸´æ—¶ç›®å½•
        }

        //å¤„ç†ä¸Šä¼ çš„æ–‡ä»¶ä¸€èˆ¬éœ€è¦é€šè¿‡æµæ¥è·å–ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡request.getInputstream(),åŸç”Ÿæ€æ–‡ä»¶ä¸Šä¼ æµè·å–ï¼Œååˆ†éº»çƒ¦
        //ä½†æ˜¯æˆ‘ä»¬éƒ½å»ºè®®ä½¿ç”¨Apacheçš„æ–‡ä»¶ä¸Šä¼ ç»„ä»¶æ¥å®ç°ï¼Œcommon-fileupload,å®ƒéœ€è¦ä¾èµ–äºcommon-ioç»„ä»¶ï¼›

        try {
            //1ã€åˆ›å»ºDiskFileItemFactoryå¯¹è±¡ï¼Œå¤„ç†æ–‡ä»¶ä¸Šä¼ è·¯å¾„æˆ–é™åˆ¶æ–‡ä»¶å¤§å°
            DiskFileItemFactory factory = gteDiskFileItemFactory(file);
            //2ã€è·å–ServletFileUpload
            ServletFileUpload upload = getServletFileUpload(factory);
            //3ã€å¤„ç†ä¸Šä¼ æ–‡ä»¶
            String msg = uploadParseRequest(upload,request,uploadpath);
            //Servletè¯·æ±‚è½¬å‘æ¶ˆæ¯
            request.setAttribute("msg",msg);
            request.getRequestDispatcher("/info.jsp").forward(request,response);
        }catch (FileUploadException e){
            e.printStackTrace();
        }
    }
    public static DiskFileItemFactory gteDiskFileItemFactory(File file){
        //1ã€åˆ›å»ºDiskFileItemFactoryå¯¹è±¡ï¼Œå¤„ç†æ–‡ä»¶ä¸Šä¼ è·¯å¾„æˆ–é™åˆ¶æ–‡ä»¶å¤§å°
        DiskFileItemFactory factory = new DiskFileItemFactory();
        //é€šè¿‡è¿™ä¸ªå·¥å‚è®¾ç½®ä¸€ä¸ªç¼“å†²åŒºï¼Œå½“ä¸Šä¼ çš„æ–‡ä»¶å¤§å°å¤§äºç¼“å†²åŒºçš„æ—¶å€™ï¼Œå°†å®ƒæ”¾åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­ï¼›
        factory.setSizeThreshold(1024 * 1024);//ç¼“å†²åŒºå¤§å°ä¸º1M
        factory.setRepository(file);
        return factory;
    }
    public static ServletFileUpload getServletFileUpload(DiskFileItemFactory factory){
        //2ã€è·å–ServletFileUpload
        ServletFileUpload upload = new ServletFileUpload(factory);
        //ç›‘å¬æ–‡ä»¶ä¸Šä¼ è¿›åº¦
        upload.setProgressListener((pBytesRead, lpContentLenght, i) -> {
            //pBytesRead:å·²è¯»å–åˆ°çš„æ–‡ä»¶å¤§å°
            //pContentLenghtï¼šæ–‡ä»¶å¤§å°
            System.out.println("æ€»å¤§å°ï¼š"+lpContentLenght+"å·²ä¸Šä¼ ï¼š"+pBytesRead);
        });

        //å¤„ç†ä¹±ç é—®é¢˜
        upload.setHeaderEncoding("UTF-8");
        //è®¾ç½®å•ä¸ªæ–‡ä»¶çš„æœ€å¤§å€¼
        upload.setFileSizeMax(1024 * 1024 * 10);
        //è®¾ç½®æ€»å…±èƒ½å¤Ÿä¸Šä¼ æ–‡ä»¶çš„å¤§å°
        //1024 = 1kb * 1024 = 1M * 10 = 10M
        upload.setSizeMax(1024 * 1024 * 10);
        return upload;
    }
    public static String uploadParseRequest(ServletFileUpload upload,HttpServletRequest request,String uploadpath) throws IOException, FileUploadException {
        String msg = "";
        //3ã€å¤„ç†ä¸Šä¼ æ–‡ä»¶
        //ServletFileUploadå¯¹è±¡æŠŠå‰ç«¯çš„è¯·æ±‚è§£æï¼Œå°è£…æˆä¸€ä¸ªFileItemå¯¹è±¡
        List<FileItem> fileItems = upload.parseRequest(request);
        for (FileItem fileItem : fileItems) {
            if (fileItem.isFormField()){ //åˆ¤æ–­æ˜¯æ™®é€šè¡¨å•è¿˜æ˜¯å¸¦æ–‡ä»¶çš„è¡¨å•
                //getFieldNameæŒ‡çš„æ˜¯å‰ç«¯è¡¨å•æ§ä»¶çš„name
                String name = fileItem.getFieldName();
                String value = fileItem.getString("UTF-8");//å¤„ç†ä¹±ç 
                System.out.println(name+":"+value);
            }else {//åˆ¤æ–­å®ƒæ˜¯å¸¦æ–‡ä»¶çš„è¡¨å•

                //======================å¤„ç†æ–‡ä»¶=======================//

                //æ‹¿åˆ°æ–‡ä»¶çš„åå­—
                String uploadFileName = fileItem.getName();
                System.out.println("ä¸Šä¼ çš„æ–‡ä»¶åï¼š"+uploadFileName);
                //è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå…¶å€¼ä¸ºæ­¤å­—ç¬¦ä¸²ï¼Œå¹¶åˆ é™¤ä»»ä½•å‰å¯¼å’Œå°¾éšç©ºæ ¼ã€‚
                if (uploadFileName.trim().equals("") || uploadFileName == null){
                    continue;
                }

                //è·å¾—ä¸Šä¼ çš„æ–‡ä»¶åï¼Œä¾‹å¦‚/img/girl/ooa.jpg,åªéœ€è¦ooaï¼Œå…¶å‰é¢çš„åé¢çš„éƒ½ä¸éœ€è¦
                String fileName = uploadFileName.substring(uploadFileName.lastIndexOf("/") + 1);
                System.out.println("fileNameï¼š"+uploadFileName);
                //è·å¾—æ–‡ä»¶çš„åç¼€å
                String fileExtName = uploadFileName.substring(uploadFileName.lastIndexOf(".") + 1);
                      /*
                        å¦‚æœæ–‡ä»¶åç¼€åfileExtNameä¸æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„
                        å°±ç›´æ¥returnï¼Œä¸å¤„ç†ï¼Œå‘Šè¯‰ç”¨æˆ·æ–‡ä»¶ç±»å‹ä¸å¯¹
                     */

                //å¯ä»¥ä½¿ç”¨UUID(å”¯ä¸€è¯†åˆ«çš„é€šç”¨ç ),ä¿è¯æ–‡ä»¶åå”¯ä¸€
                //UUID.randomUUIDï¼Œéšæœºç”Ÿä¸€ä¸ªå”¯ä¸€è¯†åˆ«çš„é€šç”¨ç 

                //ç½‘ç»œä¼ è¾“ä¸­çš„ä¸œè¥¿ï¼Œéƒ½éœ€è¦åºåˆ—åŒ–
                //pojoï¼Œå®ä½“ç±»ï¼Œå¦‚æœæƒ³è¦åœ¨å¤šä¸ªç”µè„‘è¿è¡Œï¼Œä¼ è¾“--->éœ€è¦å§å¯¹è±¡éƒ½åºåˆ—åŒ–äº†
                //JNI=java Native Interface
                //implements Serializable ï¼šæ ‡è®°æ¥å£ï¼ŒJVM--->javaæ ˆ æœ¬åœ°æ–¹æ³•æ ˆ native-->c++

                System.out.println("æ–‡ä»¶ä¿¡æ¯ã€æ–‡ä»¶åï¼š"+fileName+"æ–‡ä»¶ç±»å‹ï¼š"+fileExtName+"ã€‘");

                //å¯ä»¥ä½¿ç”¨UUID(å”¯ä¸€é€šç”¨è¯†åˆ«ç )æ¥ä¿è¯æ–‡ä»¶åçš„ç»Ÿä¸€
                String uuidFileName = UUID.randomUUID().toString();


                //=======================ä¼ è¾“æ–‡ä»¶=========================//
                //è·å¾—æ–‡ä»¶ä¸Šä¼ çš„æµ
                InputStream inputStream = fileItem.getInputStream();

                //åˆ›å»ºä¸€ä¸ªæ–‡ä»¶è¾“å‡ºæµ
                FileOutputStream fos = new FileOutputStream(uploadpath + "/" + uuidFileName +"."+ fileExtName);

                //åˆ›å»ºä¸€ä¸ªç¼“å†²åŒº
                byte[] buffer = new byte[1024 * 1024];

                //åˆ¤æ–­æ˜¯å¦è¯»å–å®Œæ¯•
                int len = 0;

                //å¦‚æœå¤§äº0ï¼Œè¯´æ˜è¿˜å­˜åœ¨æ•°æ®
                while ((len=inputStream.read(buffer))>0){
                    fos.write(buffer,0,len);
                }
                //å…³é—­æµ
                fos.close();
                inputStream.close();
                msg = "æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼";
                fileItem.delete();//ä¸Šä¼ æˆåŠŸï¼Œæ¸…é™¤ä¸´æ—¶æ–‡ä»¶
            }
        }

        return msg;
    }
}
```

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Title</title>
</head>
<body>
${msg}
</body>
</html>
```





### 16ã€æ”¶å‘é‚®ä»¶

------

#### 1.ç”µå­é‚®ä»¶

è¦åœ¨ç½‘ç»œä¸Šå®ç°é‚®ä»¶åŠŸèƒ½ï¼Œå¿…é¡»è¦æœ‰ä¸“é—¨çš„**é‚®ä»¶æœåŠ¡å™¨ã€‚**

è¿™äº›é‚®ä»¶æœåŠ¡å™¨ç±»ä¼¼äºç°å®ç”Ÿæ´»ä¸­çš„é‚®å±€ï¼Œå®ƒä¸»è¦è´Ÿè´£æ¥æ”¶ç”¨æˆ·æŠ•é€’è¿‡æ¥çš„é‚®ä»¶ï¼Œå¹¶æŠŠé‚®ä»¶æŠ•é€’åˆ°é‚®ä»¶æ¥æ”¶è€…çš„ç”µå­é‚®ç®±ä¸­ã€‚

SMTPæœåŠ¡å™¨åœ°å€ï¼šä¸€èˆ¬æ˜¯ smtp.xxx.comï¼Œæ¯”å¦‚163é‚®ç®±æ˜¯smtp.163.comï¼Œqqé‚®ç®±æ˜¯smtp.qq.comã€‚

ç”µå­é‚®ç®±(E-Mailåœ°å€)çš„è·å¾—éœ€è¦åœ¨é‚®ä»¶æœåŠ¡å™¨ä¸Šè¿›è¡Œç”³è¯·ã€‚æ¯”å¦‚æˆ‘ä»¬è¦ä½¿ç”¨QQé‚®ç®±ï¼Œå°±éœ€è¦å¼€é€šé‚®ç®±åŠŸèƒ½;



#### 2.ä¼ è¾“åè®®

SMTPåè®®

**å‘é€é‚®ä»¶ï¼š**

æˆ‘ä»¬é€šå¸¸æŠŠå¤„ç†ç”¨æˆ·smtpè¯·æ±‚ï¼ˆé‚®ä»¶å‘é€è¯·æ±‚ï¼‰çš„æœåŠ¡å™¨ç§°ä¹‹ä¸ºSmtpæœåŠ¡å™¨ï¼ˆé‚®ä»¶å‘é€æœåŠ¡å™¨ï¼‰

POP3åè®®

**æ¥æ”¶é‚®ä»¶ï¼š**

æˆ‘ä»¬é€šå¸¸æŠŠå¤„ç†ç”¨æˆ·pop3è¯·æ±‚ï¼ˆé‚®ä»¶æ¥æ”¶è¯·æ±‚ï¼‰çš„æœåŠ¡å™¨ç§°ä¹‹ä¸ºPOP3æœåŠ¡å™¨ï¼ˆé‚®ä»¶æ¥æ”¶æœåŠ¡å™¨ï¼‰



**é‚®ä»¶æ”¶å‘åŸç†ï¼š**

![image-20220320163402146](JavaWeb.assets/image-20220320163402146.png)



1.å°ç‹é€šè¿‡smtpåè®®è¿æ¥åˆ°SmtpæœåŠ¡å™¨ï¼Œç„¶åå‘é€ä¸€å°é‚®ä»¶ç»™ç½‘æ˜“çš„é‚®ä»¶æœåŠ¡å™¨

2.ç½‘æ˜“åˆ†æå‘ç°éœ€è¦å»QQçš„é‚®ä»¶æœåŠ¡å™¨ï¼Œé€šè¿‡smtpåè®®å°†é‚®ä»¶è½¬æŠ•ç»™QQçš„SmtpæœåŠ¡å™¨

3. QQå°†æ¥æ”¶åˆ°çš„é‚®ä»¶å­˜å‚¨åœ¨2910919712@qq.comè¿™ä¸ªé‚®ä»¶è´¦å·çš„ç©ºé—´ä¸­
4. å¤§ç‹é€šè¿‡Pop3åè®®è¿æ¥åˆ°Pop3æœåŠ¡å™¨æ”¶å–é‚®ä»¶
5. ä»2910919712@qq.comè¿™ä¸ªé‚®ä»¶è´¦å·çš„ç©ºé—´ä¸­å–å‡ºé‚®ä»¶
6. Pop3æœåŠ¡å™¨å°†å–å‡ºæ¥çš„é‚®ä»¶é€åˆ°å¤§ç‹æ‰‹ä¸­



ã€æ³¨æ„ã€‘æœ‰å¯èƒ½ä½ æ”¶ä»¶äººåœ°å€ï¼Œå‘ä»¶äººåœ°å€ç­‰ä¿¡æ¯éƒ½æ­£ç¡®äº†ï¼Œæ§åˆ¶å°ä¹Ÿæ‰“å°äº†æ­£ç¡®çš„ä¿¡æ¯ï¼Œä½†æ˜¯åœ¨æ”¶ä»¶ç®±å°±æ˜¯æ”¶ä¸åˆ°ä¿¡æ¯ã€‚è¿™æ˜¯å› ä¸ºå¯èƒ½æ”¶ä»¶ç®±æœåŠ¡å™¨æ‹’æ”¶äº†ä½ å‘çš„é‚®ä»¶ï¼ˆæ¯”å¦‚è®¤ä¸ºä½ çš„é‚®ä»¶æ˜¯å¹¿å‘Šï¼‰ï¼Œè¿™æ—¶å€™å¯èƒ½åœ¨åƒåœ¾ç®±é‡Œèƒ½æ‰¾åˆ°ï¼Œå¯èƒ½æ‰¾ä¸åˆ°ã€‚è§£å†³åŠæ³•æ˜¯é‡å¤çš„é‚®ä»¶å†…å®¹ä¸è¦å¤šæ¬¡å‘é€ï¼Œæˆ–è€…æ›´æ¢æ”¶ä»¶ç®±è¯•è¯•



#### 3.Javaå‘é€é‚®ä»¶

**æ¦‚è¿°**

æˆ‘ä»¬å°†ç”¨ä»£ç å®Œæˆé‚®ä»¶çš„å‘é€ã€‚è¿™åœ¨å®é™…é¡¹ç›®ä¸­åº”ç”¨çš„éå¸¸å¹¿æ³›ï¼Œæ¯”å¦‚æ³¨å†Œéœ€è¦å‘é€é‚®ä»¶è¿›è¡Œè´¦å·æ¿€æ´»ï¼Œå†æ¯”å¦‚OAé¡¹ç›®ä¸­åˆ©ç”¨é‚®ä»¶è¿›è¡Œä»»åŠ¡æé†’ç­‰ç­‰ã€‚

ä½¿ç”¨Javaå‘é€E-mail ååˆ†ç®€å•ï¼Œä½†æ˜¯é¦–å…ˆä½ åº”è¯¥å‡†å¤‡JavaMail APIå’ŒJava Activation Frameworkã€‚

å¾—åˆ°ä¸¤ä¸ªjaråŒ…ï¼š

- mail.jar
- activation.jar

```xml
<!-- https://mvnrepository.com/artifact/javax.mail/mail -->
<dependency>
    <groupId>javax.mail</groupId>
    <artifactId>mail</artifactId>
    <version>1.4.7</version>
</dependency>
```

```xml
<!-- https://mvnrepository.com/artifact/javax.activation/activation -->
<dependency>
    <groupId>javax.activation</groupId>
    <artifactId>activation</artifactId>
    <version>1.1.1</version>
</dependency>
```



JavaMail æ˜¯sunå…¬å¸ï¼ˆç°ä»¥è¢«ç”²éª¨æ–‡æ”¶è´­ï¼‰ä¸ºæ–¹ä¾¿Javaå¼€å‘äººå‘˜åœ¨åº”ç”¨ç¨‹åºä¸­å®ç°é‚®ä»¶å‘é€å’Œæ¥æ”¶åŠŸèƒ½è€Œæä¾›çš„ä¸€å¥—æ ‡å‡†å¼€å‘åŒ…ï¼Œå®ƒæ”¯æŒä¸€äº›å¸¸ç”¨çš„é‚®ä»¶åè®®ï¼Œå¦‚å‰é¢æ‰€è®²çš„SMTPï¼ŒPOP3ï¼ŒIMAP,è¿˜æœ‰MIMEç­‰ã€‚æˆ‘ä»¬åœ¨ä½¿ç”¨JavaMail APIç¼–å†™é‚®ä»¶æ—¶ï¼Œæ— é¡»è€ƒè™‘é‚®ä»¶çš„åº•å±‚å®ç°ç»†èŠ‚ï¼Œåªè¦è°ƒç”¨JavaMail å¼€å‘åŒ…ä¸­ç›¸åº”çš„APlç±»å°±å¯ä»¥äº†ã€‚

æˆ‘ä»¬å¯ä»¥å…ˆå°è¯•å‘é€ä¸€å°ç®€å•çš„é‚®ä»¶ï¼Œç¡®ä¿ç”µè„‘å¯ä»¥è¿æ¥ç½‘ç»œã€‚

- åˆ›å»ºåŒ…å«é‚®ä»¶æœåŠ¡å™¨çš„ç½‘ç»œè¿æ¥ä¿¡æ¯çš„Sessionå¯¹è±¡ã€‚

- åˆ›å»ºä»£è¡¨é‚®ä»¶å†…å®¹çš„Messageå¯¹è±¡

- åˆ›å»ºTransportå¯¹è±¡ï¼Œè¿æ¥æœåŠ¡å™¨ï¼Œå‘é€Messageï¼Œå…³é—­è¿æ¥

  

ä¸»è¦æœ‰å››ä¸ªæ ¸å¿ƒç±»ï¼Œæˆ‘ä»¬åœ¨ç¼–å†™ç¨‹åºæ—¶ï¼Œè®°ä½è¿™å››ä¸ªæ ¸å¿ƒç±»ï¼Œå°±å¾ˆå®¹æ˜“ç¼–å†™å‡ºJavaé‚®ä»¶å¤„ç†ç¨‹åºã€‚



![image-20220320165327411](JavaWeb.assets/image-20220320165327411.png)

```java
package com.peng;

import com.sun.mail.util.MailSSLSocketFactory;

import javax.mail.*;
import javax.mail.internet.InternetAddress;
import javax.mail.internet.MimeMessage;
import java.security.GeneralSecurityException;
import java.util.Properties;

//å‘é€ä¸€å°ç®€å•çš„é‚®ä»¶
public class MailDemo {
    public static void main(String[] args) throws GeneralSecurityException, MessagingException {
        Properties prop=new Properties();
        prop.setProperty("mail.host","smtp.qq.com");///è®¾ç½®QQé‚®ä»¶SMTPæœåŠ¡å™¨
        prop.setProperty("mail.transport.protocol","smtp");//é‚®ä»¶å‘é€åè®®
        prop.setProperty("mail.smtp.auth","true");//éœ€è¦éªŒè¯ç”¨æˆ·å¯†ç  authentication

        //QQé‚®ç®±éœ€è¦è®¾ç½®SSLåŠ å¯†
        MailSSLSocketFactory sf=new MailSSLSocketFactory();
        sf.setTrustAllHosts(true);
        prop.put("mail.smtp.ssl.enable","true");
        prop.put("mail.smtp.ssl.socketFactory",sf);
        //=========================================ä½¿ç”¨javaMailå‘é€é‚®ä»¶çš„5ä¸ªæ­¥éª¤===========================================
        //1.åˆ›å»ºå®šä¹‰æ•´ä¸ªåº”ç”¨ç¨‹åºæ‰€éœ€è¦çš„ç¯å¢ƒä¿¡æ¯çš„sessionå¯¹è±¡
        Session session = Session.getDefaultInstance(prop, new Authenticator() {
            @Override
            protected PasswordAuthentication getPasswordAuthentication() {
                return new PasswordAuthentication("2910919712@qq.com","htthxatnbgvbddii");
            }
        });
        //å¼€å¯sessionçš„debugæ¨¡å¼ï¼Œè¿™æ ·å¯ä»¥æŸ¥çœ‹åˆ°ç¨‹åºå‘é€Emailçš„è¿è¡ŒçŠ¶æ€
        session.setDebug(true);
        //2.é€šè¿‡sessionå¾—åˆ°transportå¯¹è±¡
        Transport ts=session.getTransport();
        //3.ä½¿ç”¨é‚®ç®±çš„ç”¨æˆ·åå’Œæˆæƒç è¿ä¸Šé‚®ä»¶æœåŠ¡å™¨ htthxatnbgvbddii
        ts.connect("smtp.qq.com","2910919712@qq.com","htthxatnbgvbddii");
        //4.åˆ›å»ºé‚®ä»¶ï¼šå†™æ–‡ä»¶
        //æ³¨æ„éœ€è¦ä¼ é€’session
        MimeMessage message=new MimeMessage(session);
        //æŒ‡æ˜é‚®ä»¶çš„å‘ä»¶äºº
        message.setFrom(new InternetAddress("2910919712@qq.com"));
        //æŒ‡æ˜é‚®ä»¶çš„æ”¶ä»¶äºº
        message.setRecipient(Message.RecipientType.TO,new InternetAddress("2910919712@qq.com"));
        //é‚®ä»¶æ ‡é¢˜
        message.setSubject("ä½ ä¸­å¥–äº†");
        //é‚®ä»¶çš„æ–‡æœ¬å†…å®¹
        message.setContent("ä½ å¦¹çš„ï¼ï¼ï¼","text/html;charset=UTF-8");
        //5.å‘é€é‚®ä»¶
        ts.sendMessage(message,message.getAllRecipients());
        //6.å…³é—­è¿æ¥
        ts.close();
    }
}
```



#### 4.MIMEæ”¯æŒ

**å¤šç”¨é€”äº’è”ç½‘é‚®ä»¶æ‰©å±•**ï¼ˆè‹±è¯­ï¼š**M**ultipurpose **I**nternet **M**ail **E**xtensionsï¼Œç¼©å†™ï¼š**MIME**ï¼‰æ˜¯ä¸€ä¸ª[äº’è”ç½‘æ ‡å‡†](https://zh.wikipedia.org/wiki/äº’è”ç½‘æ ‡å‡†)ï¼Œå®ƒæ‰©å±•äº†[ç”µå­é‚®ä»¶](https://zh.wikipedia.org/wiki/ç”µå­é‚®ä»¶)æ ‡å‡†ï¼Œä½¿å…¶èƒ½å¤Ÿæ”¯æŒï¼š

- é[ASCII](https://zh.wikipedia.org/wiki/ASCII)å­—ç¬¦æ–‡æœ¬ï¼›
- éæ–‡æœ¬æ ¼å¼é™„ä»¶ï¼ˆ[äºŒè¿›åˆ¶](https://zh.wikipedia.org/wiki/äºŒè¿›åˆ¶)ã€å£°éŸ³ã€å›¾åƒç­‰ï¼‰ï¼›
- ç”±å¤šéƒ¨åˆ†ï¼ˆmultiple partsï¼‰ç»„æˆçš„æ¶ˆæ¯ä½“ï¼›
- åŒ…å«é[ASCII](https://zh.wikipedia.org/wiki/ASCII)å­—ç¬¦çš„å¤´ä¿¡æ¯ï¼ˆHeader informationï¼‰ã€‚è¿™ä¸ªæ ‡å‡†è¢«å®šä¹‰åœ¨ [RFC 2045](https://tools.ietf.org/html/rfc2045)ã€[RFC 2046](https://tools.ietf.org/html/rfc2046)ã€[RFC 2047](https://tools.ietf.org/html/rfc2047)ã€[RFC 2048](https://tools.ietf.org/html/rfc2048)ã€[RFC 2049](https://tools.ietf.org/html/rfc2049) ç­‰[RFC](https://zh.wikipedia.org/wiki/RFC)ä¸­ã€‚

![mowjOAuiry7ZN2U](JavaWeb.assets/mowjOAuiry7ZN2U.png)



**æ¯ä¸€ä¸ªæ–‡æœ¬ã€å›¾ç‰‡ã€é™„ä»¶å¯ä»¥åˆ†ä¸ºä¸€ä¸ªMimeBodyPartï¼Œç”±MimeMultipartå®Œæˆç»„è£…**

```java
        Properties prop = new Properties();
        prop.setProperty("mail.host","smtp.qq.com");///è®¾ç½®QQé‚®ä»¶æœåŠ¡å™¨
        prop.setProperty("mail.transport.protocol","smtp");///é‚®ä»¶å‘é€åè®®
        prop.setProperty("mail.smtp.auth","true");//éœ€è¦éªŒè¯ç”¨æˆ·å¯†ç 
        //QQé‚®ç®±éœ€è¦è®¾ç½®SSLåŠ å¯†
        MailSSLSocketFactory sf=new MailSSLSocketFactory();
        sf.setTrustAllHosts(true);
        prop.put("mail.smtp.ssl.enable","true");
        prop.put("mail.smtp.ssl.socketFactory",sf);

        //ä½¿ç”¨javaMailå‘é€é‚®ä»¶çš„5ä¸ªæ­¥éª¤
        //1.åˆ›å»ºå®šä¹‰æ•´ä¸ªåº”ç”¨ç¨‹åºæ‰€éœ€è¦çš„ç¯å¢ƒä¿¡æ¯çš„sessionå¯¹è±¡
        Session session=Session.getDefaultInstance(prop, new Authenticator() {
            @Override
            protected PasswordAuthentication getPasswordAuthentication() {
                return new PasswordAuthentication("2910919712@qq.com","htthxatnbgvbddii");
            }
        });
        //å¼€å¯sessionçš„debugæ¨¡å¼ï¼Œè¿™æ ·å¯ä»¥æŸ¥çœ‹åˆ°ç¨‹åºå‘é€Emailçš„è¿è¡ŒçŠ¶æ€
        session.setDebug(true);
        //2.é€šè¿‡sessionå¾—åˆ°transportå¯¹è±¡
        Transport ts=session.getTransport();
        //3.ä½¿ç”¨é‚®ç®±çš„ç”¨æˆ·åå’Œæˆæƒç è¿ä¸Šé‚®ä»¶æœåŠ¡å™¨
        ts.connect("smtp.qq.com","2910919712@qq.com","htthxatnbgvbddii");
        //4.åˆ›å»ºé‚®ä»¶ï¼šå†™æ–‡ä»¶
        //æ³¨æ„éœ€è¦ä¼ é€’session
        MimeMessage message=new MimeMessage(session);
        //æŒ‡æ˜é‚®ä»¶çš„å‘ä»¶äºº
        message.setFrom(new InternetAddress("2910919712@qq.com"));
        //æŒ‡æ˜é‚®ä»¶çš„æ”¶ä»¶äºº
        message.setRecipient(Message.RecipientType.TO,new InternetAddress("2910919712@qq.com"));
        //é‚®ä»¶æ ‡é¢˜
        message.setSubject("javaå‘å‡º");

        //é‚®ä»¶çš„æ–‡æœ¬å†…å®¹
        //=================================å‡†å¤‡å›¾ç‰‡æ•°æ®=======================================
        MimeBodyPart image=new MimeBodyPart();
        //å›¾ç‰‡éœ€è¦ç»è¿‡æ•°æ®åŒ–çš„å¤„ç†
        DataHandler dh=new DataHandler(new FileDataSource("D:\\ForStrong_java\\javaweb\\javaweb-08-sendMail\\src\\20200708003918960.png"));
        //åœ¨partä¸­æ”¾å…¥è¿™ä¸ªå¤„ç†è¿‡å›¾ç‰‡çš„æ•°æ®
        image.setDataHandler(dh);
        //ç»™è¿™ä¸ªpartè®¾ç½®ä¸€ä¸ªIDåå­—
        image.setContentID("bz.jpg");

        //å‡†å¤‡æ­£æ–‡çš„æ•°æ®
        MimeBodyPart text=new MimeBodyPart();
        text.setContent("è¿™æ˜¯ä¸€å¼ æ­£æ–‡<img src='cid:bz.jpg'>","text/html;charset=UTF-8");

        //æè¿°æ•°æ®å…³ç³»
        MimeMultipart mm=new MimeMultipart();
        mm.addBodyPart(text);
        mm.addBodyPart(image);
        mm.setSubType("related");

        //è®¾ç½®åˆ°æ¶ˆæ¯ä¸­ï¼Œä¿å­˜ä¿®æ”¹
        message.setContent(mm);
        message.saveChanges();
        //5.å‘é€é‚®ä»¶
        ts.sendMessage(message,message.getAllRecipients());

        //6.å…³é—­è¿æ¥
        ts.close();

```

